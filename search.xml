<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>juc学习笔记</title>
      <link href="/2021/10/28/juc-bing-fa-bian-cheng-xue-xi-bi-ji/"/>
      <url>/2021/10/28/juc-bing-fa-bian-cheng-xue-xi-bi-ji/</url>
      
        <content type="html"><![CDATA[<h1 id="1-生产者消费者旧代码实现"><a href="#1-生产者消费者旧代码实现" class="headerlink" title="1.生产者消费者旧代码实现"></a>1.生产者消费者旧代码实现</h1><h2 id=""><a href="#" class="headerlink" title=""></a></h2><pre><code>```java</code></pre><p>/**</p><ul><li><p>@Author 高国超</p></li><li><p>@Date 2021/10/28 21:03</p></li><li><p>@Version 1.0</p></li><li><p>线程间的通信问题 生产者和消费者</p></li><li><p>线程交替 A B 操作同一个变量 nun=0</p></li><li><p>A num+1</p></li><li><p>B num-1</p></li><li><p>但是在多个线程的情况下就会出错</p></li><li><p>注意：需要在生产和消费的时候使用while，不能使用if,这样就不会出现虚假生产的问题，多线程生产和消费出错的问题就能解决</p></li><li><p>/<br>public class ProducterAndCustomer {<br>  public static void main(String[] args) {</p><pre><code>  Data data = new Data();  new Thread(()-&gt;{      for (int i = 0; i &lt; 10; i++) {          try {              data.increment();          } catch (InterruptedException e) {              e.printStackTrace();          }      }  },"A").start();  new Thread(()-&gt;{      for (int i = 0; i &lt; 10; i++) {          try {              data.decrement();          } catch (InterruptedException e) {              e.printStackTrace();          }      }  },"B").start();  new Thread(()-&gt;{      for (int i = 0; i &lt; 10; i++) {          try {              data.increment();          } catch (InterruptedException e) {              e.printStackTrace();          }      }  },"C").start();  new Thread(()-&gt;{      for (int i = 0; i &lt; 10; i++) {          try {              data.decrement();          } catch (InterruptedException e) {              e.printStackTrace();          }      }  },"D").start();</code></pre><p>  }<br>}</p></li></ul><p>class  Data{<br>    private  int number = 0;</p><pre><code>//+1public  synchronized  void increment() throws InterruptedException {    while (number!=0){       //等待        this.wait();    }    number++;    System.out.println(Thread.currentThread().getName()+"=&gt;"+number);    //通知其他线程，我+1完毕了    this.notifyAll();}//-1public  synchronized  void  decrement() throws InterruptedException {    while (number==0){        //等待        this.wait();    }    number--;    System.out.println(Thread.currentThread().getName()+"=&gt;"+number);    //通知其他线程，我-1完毕了    this.notifyAll();}</code></pre><p>}</p><pre><code>&gt; 改进后的生产者和消费者，使用lock进行加锁和解锁&gt;&gt; ```Java&gt; * lock锁&gt; * Lock lock = new ReentrantLock();&gt; * 随机执行，同时可以进行有序执行&gt; * Condition condition = lock.newCondition();&gt; * condition.await&gt; * condition.signalAll&gt; ``````javaclass  Datas{    private  int number = 0;    Lock lock = new ReentrantLock();    Condition condition = lock.newCondition();//    condition.await(); 等待//    condition.signalAll(); 唤醒全部    //+1    public   void increment() throws InterruptedException {        lock.lock();        try {            while (number!=0){                //等待                condition.await();            }            number++;            System.out.println(Thread.currentThread().getName()+"=&gt;"+number);            //通知其他线程，我+1完毕了 唤醒全部            condition.signalAll();        } catch (Exception e) {            e.printStackTrace();        } finally {//            解锁            lock.unlock();        }    }    //-1    public  synchronized  void  decrement() throws InterruptedException {        //先上锁        lock.lock();        try {            while (number==0){                //等待                condition.await();            }            number--;            System.out.println(Thread.currentThread().getName()+"=&gt;"+number);            //通知其他线程，我-1完毕了            condition.signalAll();        } catch (Exception e) {            e.printStackTrace();        } finally {            lock.unlock();        }    }}</code></pre><blockquote><p>循环执行线程A、B、C</p></blockquote><pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">/** * @Author 高国超 * @Date 2021/10/29 10:15 * @Version 1.0 * * * 循环执行线程A、B、C */</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">NewLockP</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>        Data1 data1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Data1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token punctuation">{</span>            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                data1<span class="token punctuation">.</span><span class="token function">printA</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token punctuation">{</span>            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                data1<span class="token punctuation">.</span><span class="token function">printB</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token punctuation">{</span>            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                data1<span class="token punctuation">.</span><span class="token function">printC</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">class</span>  <span class="token class-name">Data1</span><span class="token punctuation">{</span>     <span class="token keyword">private</span> Lock lock <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ReentrantLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    Condition condition1 <span class="token operator">=</span> lock<span class="token punctuation">.</span><span class="token function">newCondition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    Condition condition2 <span class="token operator">=</span> lock<span class="token punctuation">.</span><span class="token function">newCondition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    Condition condition3 <span class="token operator">=</span> lock<span class="token punctuation">.</span><span class="token function">newCondition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">int</span> number <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//numeber=1；A执行  number=2:B 执行 number=3: C执行</span>     <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">printA</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>         <span class="token comment" spellcheck="true">//加锁</span>         lock<span class="token punctuation">.</span><span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>         <span class="token keyword">try</span> <span class="token punctuation">{</span>             <span class="token comment" spellcheck="true">//业务，判断—》执行-》通知</span>             <span class="token keyword">while</span> <span class="token punctuation">(</span>number<span class="token operator">!=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                 <span class="token comment" spellcheck="true">//等待</span>                 condition1<span class="token punctuation">.</span><span class="token function">await</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>             <span class="token punctuation">}</span>             System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>Thread<span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">"=>AAAAAAAAAAAA"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>             <span class="token comment" spellcheck="true">//唤醒B</span>             number <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>             condition2<span class="token punctuation">.</span><span class="token function">signal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>         <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>             e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>         <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>             lock<span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>         <span class="token punctuation">}</span>     <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">printB</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>         lock<span class="token punctuation">.</span><span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">try</span> <span class="token punctuation">{</span>            <span class="token comment" spellcheck="true">//业务，判断—》执行-》通知</span>            <span class="token keyword">while</span> <span class="token punctuation">(</span>number<span class="token operator">!=</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                <span class="token comment" spellcheck="true">//等待</span>                condition2<span class="token punctuation">.</span><span class="token function">await</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>            System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>Thread<span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">"=>BBBBBBBBBB"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment" spellcheck="true">//唤醒C</span>            number <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>            condition3<span class="token punctuation">.</span><span class="token function">signal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>            lock<span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">printC</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>         lock<span class="token punctuation">.</span><span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">try</span> <span class="token punctuation">{</span>            <span class="token comment" spellcheck="true">//业务，判断—》执行-》通知</span>            <span class="token keyword">while</span> <span class="token punctuation">(</span>number<span class="token operator">!=</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                <span class="token comment" spellcheck="true">//等待</span>                condition3<span class="token punctuation">.</span><span class="token function">await</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>            System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>Thread<span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">"=>CCCCCCCCCCCCCC"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment" spellcheck="true">//唤醒A</span>            number <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>            condition1<span class="token punctuation">.</span><span class="token function">signal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>            lock<span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><blockquote><p>juc 类：import java.util.concurrent  JUC</p></blockquote><p>TimeUnit：类</p><blockquote><p>八锁问题</p></blockquote><h1 id="2-并发下的ArrayList集合不安全"><a href="#2-并发下的ArrayList集合不安全" class="headerlink" title="2.并发下的ArrayList集合不安全"></a>2.并发下的ArrayList集合不安全</h1><pre class=" language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>        ArrayList<span class="token operator">&lt;</span>String <span class="token operator">></span> list <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token operator">&lt;</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">100</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token punctuation">{</span>                list<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>UUID<span class="token punctuation">.</span><span class="token function">randomUUID</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>list<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span><span class="token punctuation">,</span>String<span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span></code></pre><blockquote><p>解决方法</p><pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">//解决方法  copyOnWrite cow  多个线程调用的时候，list读取的时候是固定的，写入（覆盖） 在写入的时候避免覆盖，造成数据问题 与vector更加有效率</span>CopyOnWriteArrayList<span class="token operator">&lt;</span>String<span class="token operator">></span> list <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CopyOnWriteArrayList</span><span class="token operator">&lt;</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></blockquote><blockquote><p>同理： CopyOnWriteHashSet 与HashSet  ,前者更好</p><p>工作中同样也不使用HashMap  </p><p>new HashMap&lt;&gt;(16,0.75):hashmap的默认容量是16，加载因子为0.75</p><p>解决方法为：ConcurrentHashMap&lt;Object, Object&gt; hashMap = new ConcurrentHashMap&lt;&gt;();</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> JUC </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 总结 </tag>
            
            <tag> JUC </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>jvm学习笔记</title>
      <link href="/2021/10/28/jvm-xue-xi-bi-ji/"/>
      <url>/2021/10/28/jvm-xue-xi-bi-ji/</url>
      
        <content type="html"><![CDATA[]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>linux学习笔记</title>
      <link href="/2021/10/22/linux-xue-xi-bi-ji/"/>
      <url>/2021/10/22/linux-xue-xi-bi-ji/</url>
      
        <content type="html"><![CDATA[<h1 id="linux"><a href="#linux" class="headerlink" title="linux"></a>linux</h1><h2 id="1-关机操作"><a href="#1-关机操作" class="headerlink" title="1.关机操作"></a>1.关机操作</h2><p>关机指令为：shutdown ；</p><blockquote><p>ync # 将数据由内存同步到硬盘中。<br>shutdown # 关机指令，你可以man shutdown 来看一下帮助文档。例如你可以运行如下命令关机：<br>shutdown –h 10 # 这个命令告诉大家，计算机将在10分钟后关机<br>shutdown –h now # 立马关机<br>shutdown –h 20:25 # 系统会在今天20:25关机<br>shutdown –h +10 # 十分钟后关机<br>shutdown –r now # 系统立马重启<br>shutdown –r +10 # 系统十分钟后重启<br>reboot # 就是重启，等同于 shutdown –r now<br>halt # 关闭系统，等同于shutdown –h now 和 poweroff</p></blockquote><p>不管是重启系统还是关闭系统，首先要运行 sync 命令，把内存中的数据写到磁盘中。</p><blockquote><p>登录系统后，在当前命令窗口下输入命令：ls<br><img src="https://edu-2539.oss-cn-beijing.aliyuncs.com/linux%E5%8D%9A%E5%AE%A2%E5%9B%BE%E7%89%87/snipaste_20211022_183001.png" alt="image"></p></blockquote><p><img src="https://edu-2539.oss-cn-beijing.aliyuncs.com/linux%E5%8D%9A%E5%AE%A2%E5%9B%BE%E7%89%87/640.webp" alt="image"></p><p>以下是对这些目录的解释：</p><ul><li><p>/bin：bin是Binary的缩写, 这个目录存放着最经常使用的命令。</p></li><li><p>/boot： 这里存放的是启动Linux时使用的一些核心文件，包括一些连接文件以及镜像文件。</p></li><li><p>/dev ： dev是Device(设备)的缩写, 存放的是Linux的外部设备，在Linux中访问设备的方式和访问文件的方式是相同的。</p></li><li><p>/etc： 这个目录用来存放所有的系统管理所需要的配置文件和子目录。</p></li><li><p>/home：用户的主目录，在Linux中，每个用户都有一个自己的目录，一般该目录名是以用户的账号命名的。</p></li><li><p>/lib：这个目录里存放着系统最基本的动态连接共享库，其作用类似于Windows里的DLL文件。</p></li><li><p>/lost+found：这个目录一般情况下是空的，当系统非法关机后，这里就存放了一些文件。</p></li><li><p>/media：linux系统会自动识别一些设备，例如U盘、光驱等等，当识别后，linux会把识别的设备挂载到这个目录下。</p></li><li><p>/mnt：系统提供该目录是为了让用户临时挂载别的文件系统的，我们可以将光驱挂载在/mnt/上，然后进入该目录就可以查看光驱里的内容了。</p></li><li><p>/opt：这是给主机额外安装软件所摆放的目录。比如你安装一个ORACLE数据库则就可以放到这个目录下。默认是空的。</p></li><li><p>/proc：这个目录是一个虚拟的目录，它是系统内存的映射，我们可以通过直接访问这个目录来获取系统信息。</p></li><li><p>/root：该目录为系统管理员，也称作超级权限者的用户主目录。</p></li><li><p>/sbin：s就是Super User的意思，这里存放的是系统管理员使用的系统管理程序。</p></li><li><p>/srv：该目录存放一些服务启动之后需要提取的数据。</p></li><li><p>/sys：这是linux2.6内核的一个很大的变化。该目录下安装了2.6内核中新出现的一个文件系统 sysfs 。</p></li><li><p>/tmp：这个目录是用来存放一些临时文件的。</p></li><li><p>/usr：这是一个非常重要的目录，用户的很多应用程序和文件都放在这个目录下，类似于windows下的program files目录。</p></li><li><p>/usr/bin： 系统用户使用的应用程序。</p></li><li><p>/usr/sbin： 超级用户使用的比较高级的管理程序和系统守护程序。</p></li><li><p>/usr/src： 内核源代码默认的放置目录。</p></li><li><p>/var：这个目录中存放着在不断扩充着的东西，我们习惯将那些经常被修改的目录放在这个目录下。包括各种日志文件。</p></li><li><p>/run：是一个临时文件系统，存储系统启动以来的信息。当系统重启时，这个目录下的文件应该被删掉或清除。</p></li></ul><h1 id="linux-基本命令"><a href="#linux-基本命令" class="headerlink" title="linux 基本命令"></a>linux 基本命令</h1><blockquote><p>处理目录的常用命令</p></blockquote><ul><li><p>ls: 列出目录</p></li><li><p>cd：切换目录</p></li><li><p>pwd：显示目前的目录</p></li><li><p>mkdir：创建一个新的目录</p></li><li><p>dir：删除一个空的目录</p></li><li><p>: 复制文件或目录</p></li><li><p>: 移除文件或目录</p></li><li><p>: 移动文件与目录，或修改文件与目录的名称</p></li></ul><blockquote><p>ls(列出列表）</p></blockquote><p>选项与参数：</p><p>-a ：全部的文件，连同隐藏文件( 开头为 . 的文件) 一起列出来(常用)</p><p>-l ：长数据串列出，包含文件的属性与权限等等数据；(常用)</p><p>将目录下的所有文件列出来(含属性与隐藏档)</p><blockquote><p>cd 目录<br>pwd 显示当前所在目录<br>pwd -P 显示当前确实的路径</p></blockquote><blockquote><p>mkdir 创建文件目录<br>选项与参数：<br>-m ：配置文件的权限喔！直接配置，不需要看默认权限 (umask) 的脸色～<br>-p ：帮助你直接将所需要的目录(包含上一级目录)递归创建起来！</p></blockquote><p>测试：</p><pre class=" language-javascript"><code class="language-javascript"># 进入我们用户目录下<span class="token punctuation">[</span>root@kuangshen <span class="token operator">/</span><span class="token punctuation">]</span># cd <span class="token operator">/</span>home# 创建一个 test 文件夹<span class="token punctuation">[</span>root@kuangshen home<span class="token punctuation">]</span># mkdir test# 创建多层级目录<span class="token punctuation">[</span>root@kuangshen home<span class="token punctuation">]</span># mkdir test1<span class="token operator">/</span>test2<span class="token operator">/</span>test3<span class="token operator">/</span>test4mkdir<span class="token punctuation">:</span> cannot create directory ‘test1<span class="token operator">/</span>test2<span class="token operator">/</span>test3<span class="token operator">/</span>test4’<span class="token punctuation">:</span>No such file or directory  # <span class="token operator">&lt;=</span><span class="token operator">=</span> 没办法直接创建此目录啊！# 加了这个 <span class="token operator">-</span>p 的选项，可以自行帮你创建多层目录！<span class="token punctuation">[</span>root@kuangshen home<span class="token punctuation">]</span># mkdir <span class="token operator">-</span>p test1<span class="token operator">/</span>test2<span class="token operator">/</span>test3<span class="token operator">/</span>test4# 创建权限为 rwx<span class="token operator">--</span>x<span class="token operator">--</span>x 的目录。<span class="token punctuation">[</span>root@kuangshen home<span class="token punctuation">]</span># mkdir <span class="token operator">-</span>m <span class="token number">711</span> test2<span class="token punctuation">[</span>root@kuangshen home<span class="token punctuation">]</span># ls <span class="token operator">-</span>ldrwxr<span class="token operator">-</span>xr<span class="token operator">-</span>x <span class="token number">2</span> root root  <span class="token number">4096</span> Mar <span class="token number">12</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">55</span> testdrwxr<span class="token operator">-</span>xr<span class="token operator">-</span>x <span class="token number">3</span> root root  <span class="token number">4096</span> Mar <span class="token number">12</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">56</span> test1drwx<span class="token operator">--</span>x<span class="token operator">--</span>x <span class="token number">2</span> root root  <span class="token number">4096</span> Mar <span class="token number">12</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">58</span> test2</code></pre><blockquote><p>rmdir (删除空的目录)<br>rmdir [-p] 目录名称选项与参数：-p ：连同上一级『空的』目录也一起删除</p></blockquote><blockquote><p>cp 文件复制<br>[root@www ~]# cp [-adfilprsu] 来源档(source) 目标档(destination)<br>[root@www ~]# cp [options] source1 source2 source3 …. directory</p></blockquote><p>选项与参数：</p><p>-a：相当於 -pdr 的意思，至於 pdr 请参考下列说明；(常用)</p><p>-p：连同文件的属性一起复制过去，而非使用默认属性(备份常用)；</p><p>-d：若来源档为连结档的属性(link file)，则复制连结档属性而非文件本身；</p><p>-r：递归持续复制，用於目录的复制行为；(常用)</p><p>-f：为强制(force)的意思，若目标文件已经存在且无法开启，则移除后再尝试一次；</p><p>-i：若目标档(destination)已经存在时，在覆盖时会先询问动作的进行(常用)</p><p>-l：进行硬式连结(hard link)的连结档创建，而非复制文件本身。</p><p>-s：复制成为符号连结档 (symbolic link)，亦即『捷径』文件；</p><p>-u：若 destination 比 source 旧才升级 destination ！</p><blockquote><p>rm ( 移除文件或目录 )<br>选项与参数：</p></blockquote><p>-f ：就是 force 的意思，忽略不存在的文件，不会出现警告信息；</p><p>-i ：互动模式，在删除前会询问使用者是否动作</p><p>-r ：递归删除啊！最常用在目录的删除了！这是非常危险的选项！！！</p><blockquote><p>mv &nbsp;( 移动文件与目录，或修改名称 )</p></blockquote><p>[root@www ~]# mv [-fiu] source destination<br>[root@www ~]# mv [options] source1 source2 source3 …. directory</p><p>选项与参数：</p><p>-f ：force 强制的意思，如果目标文件已经存在，不会询问而直接覆盖；</p><p>-i ：若目标文件 (destination) 已经存在时，就会询问是否覆盖！</p><p>-u ：若目标文件已经存在，且 source 比较新，才会升级 (update)</p><p>测试：</p><pre class=" language-javascript"><code class="language-javascript"># 复制一个文件到当前目录<span class="token punctuation">[</span>root@kuangshen home<span class="token punctuation">]</span># cp <span class="token operator">/</span>root<span class="token operator">/</span>install<span class="token punctuation">.</span>sh <span class="token operator">/</span>home# 创建一个文件夹 test<span class="token punctuation">[</span>root@kuangshen home<span class="token punctuation">]</span># mkdir test# 将复制过来的文件移动到我们创建的目录，并查看<span class="token punctuation">[</span>root@kuangshen home<span class="token punctuation">]</span># mv install<span class="token punctuation">.</span>sh test<span class="token punctuation">[</span>root@kuangshen home<span class="token punctuation">]</span># lstest<span class="token punctuation">[</span>root@kuangshen home<span class="token punctuation">]</span># cd test<span class="token punctuation">[</span>root@kuangshen test<span class="token punctuation">]</span># lsinstall<span class="token punctuation">.</span>sh# 将文件夹重命名，然后再次查看！<span class="token punctuation">[</span>root@kuangshen test<span class="token punctuation">]</span># cd <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">[</span>root@kuangshen home<span class="token punctuation">]</span># mv test mvtest<span class="token punctuation">[</span>root@kuangshen home<span class="token punctuation">]</span># lsmvtest</code></pre><blockquote><p>基本属性</p></blockquote><p>Linux系统是一种典型的多用户系统，不同的用户处于不同的地位，拥有不同的权限。为了保护系统的安全性，Linux系统对不同的用户访问同一文件（包括目录文件）的权限做了不同的规定。在Linux中我们可以使用ll或者ls –l命令来显示一个文件的属性以及文件所属的用户和组，如：</p><p><img src="https://edu-2539.oss-cn-beijing.aliyuncs.com/linux%E5%8D%9A%E5%AE%A2%E5%9B%BE%E7%89%87/snipaste_20211022_184951.png" alt="image"></p><p>实例中，boot文件的第一个属性用”d”表示。”d”在Linux中代表该文件是一个目录文件。</p><p>在Linux中第一个字符代表这个文件是目录、文件或链接文件等等：</p><p>当为[ d ]则是目录</p><p>当为[ - ]则是文件；</p><p>若是[ l ]则表示为链接文档 ( link file )；</p><p>若是[ b ]则表示为装置文件里面的可供储存的接口设备 ( 可随机存取装置 )；</p><p>若是[ c ]则表示为装置文件里面的串行端口设备，例如键盘、鼠标 ( 一次性读取装置 )。</p><p>接下来的字符中，以三个为一组，且均为『rwx』 的三个参数的组合。</p><p>其中，[ r ]代表可读(read)、[ w ]代表可写(write)、[ x ]代表可执行(execute)。</p><p>要注意的是，这三个权限的位置不会改变，如果没有权限，就会出现减号[ - ]而已。</p><p>每个文件的属性由左边第一部分的10个字符来确定（如下图）：<br><img src="https://edu-2539.oss-cn-beijing.aliyuncs.com/linux%E5%8D%9A%E5%AE%A2%E5%9B%BE%E7%89%87/640%20%281%29.webp" alt="image"><br>从左至右用0-9这些数字来表示。</p><p>第0位确定文件类型，第1-3位确定属主（该文件的所有者）拥有该文件的权限。第4-6位确定属组（所有者的同组用户）拥有该文件的权限，第7-9位确定其他用户拥有该文件的权限。</p><p>其中：</p><p>第1、4、7位表示读权限，如果用”r”字符表示，则有读权限，如果用”-“字符表示，则没有读权限；</p><p>第2、5、8位表示写权限，如果用”w”字符表示，则有写权限，如果用”-“字符表示没有写权限；</p><p>第3、6、9位表示可执行权限，如果用”x”字符表示，则有执行权限，如果用”-“字符表示，则没有执行权限。</p><p>对于文件来说，它都有一个特定的所有者，也就是对该文件具有所有权的用户。</p><p>同时，在Linux系统中，用户是按组分类的，一个用户属于一个或多个组。</p><p>文件所有者以外的用户又可以分为文件所有者的同组用户和其他用户。</p><p>因此，Linux系统按文件所有者、文件所有者同组用户和其他用户来规定了不同的文件访问权限。</p><p>在以上实例中，boot 文件是一个目录文件，属主和属组都为 root。</p><blockquote><p>修改文件属性<br>1、chgrp：更改文件属组</p></blockquote><p>chgrp [-R] 属组名 文件名<br>-R：递归更改文件属组，就是在更改某个目录文件的属组时，如果加上-R的参数，那么该目录下的所有文件的属组都会更改。</p><p>2、chown：更改文件属主，也可以同时更改文件属组</p><p>chown [–R] 属主名 文件名<br>chown [-R] 属主名：属组名 文件名<br>3、chmod：更改文件9个属性</p><p>chmod [-R] xyz 文件或目录<br>Linux文件属性有两种设置方法，一种是数字，一种是符号。</p><p>Linux文件的基本权限就有九个，分别是owner/group/others三种身份各有自己的read/write/execute权限。</p><p>先复习一下刚刚上面提到的数据：文件的权限字符为：『-rwxrwxrwx』， 这九个权限是三个三个一组的！其中，我们可以使用数字来代表各个权限，各权限的分数对照表如下：</p><p>r:4     w:2         x:1<br>每种身份(owner/group/others)各自的三个权限(r/w/x)分数是需要累加的，例如当权限为：[-rwxrwx—] 分数则是：</p><p>owner = rwx = 4+2+1 = 7</p><p>group = rwx = 4+2+1 = 7</p><p>others= — = 0+0+0 = 0</p><p>chmod 770 filename</p><h1 id="文件内容查看"><a href="#文件内容查看" class="headerlink" title="文件内容查看"></a>文件内容查看</h1><blockquote><p>概述</p></blockquote><p>Linux系统中使用以下命令来查看文件的内容：</p><p>cat 由第一行开始显示文件内容</p><p>tac 从最后一行开始显示，可以看出 tac 是 cat 的倒着写！</p><p>nl  显示的时候，顺道输出行号！</p><p>more 一页一页的显示文件内容</p><p>less 与 more 类似，但是比 more 更好的是，他可以往前翻页！</p><p>head 只看头几行</p><p>tail 只看尾巴几行</p><p>你可以使用 man [命令]来查看各个命令的使用文档，如 ：man cp。</p><p>cat 由第一行开始显示文件内容</p><blockquote><p>语法：</p></blockquote><p>cat [-AbEnTv]<br>选项与参数：</p><p>-A ：相当於 -vET 的整合选项，可列出一些特殊字符而不是空白而已；</p><p>-b ：列出行号，仅针对非空白行做行号显示，空白行不标行号！</p><p>-E ：将结尾的断行字节 $ 显示出来；</p><p>-n ：列印出行号，连同空白行也会有行号，与 -b 的选项不同；</p><p>-T ：将 [tab] 按键以 ^I 显示出来；</p><p>-v ：列出一些看不出来的特殊字符</p><p>测试：</p><pre class=" language-javascript"><code class="language-javascript"># 查看网络配置<span class="token punctuation">:</span> 文件地址 <span class="token operator">/</span>etc<span class="token operator">/</span>sysconfig<span class="token regex">/network-scripts/</span><span class="token punctuation">[</span>root@kuangshen <span class="token operator">~</span><span class="token punctuation">]</span># cat <span class="token operator">/</span>etc<span class="token operator">/</span>sysconfig<span class="token operator">/</span>network<span class="token operator">-</span>scripts<span class="token operator">/</span>ifcfg<span class="token operator">-</span>eth0DEVICE<span class="token operator">=</span>eth0BOOTPROTO<span class="token operator">=</span>dhcpONBOOT<span class="token operator">=</span>yes</code></pre><blockquote><p>tac</p></blockquote><p>tac与cat命令刚好相反，文件内容从最后一行开始显示，可以看出 tac 是 cat 的倒着写！如：</p><pre class=" language-javascript"><code class="language-javascript"><span class="token punctuation">[</span>root@kuangshen <span class="token operator">~</span><span class="token punctuation">]</span># tac <span class="token operator">/</span>etc<span class="token operator">/</span>sysconfig<span class="token operator">/</span>network<span class="token operator">-</span>scripts<span class="token operator">/</span>ifcfg<span class="token operator">-</span>eth0ONBOOT<span class="token operator">=</span>yesBOOTPROTO<span class="token operator">=</span>dhcpDEVICE<span class="token operator">=</span>eth0</code></pre><blockquote><p>nl &nbsp;显示行号</p></blockquote><p>语法：nl [-bnw] 文件<br>选项与参数：</p><p>-b ：指定行号指定的方式，主要有两种：-b a ：表示不论是否为空行，也同样列出行号(类似 cat -n)；-b t ：如果有空行，空的那一行不要列出行号(默认值)；</p><p>-n ：列出行号表示的方法，主要有三种：-n ln ：行号在荧幕的最左方显示；-n rn ：行号在自己栏位的最右方显示，且不加 0 ；-n rz ：行号在自己栏位的最右方显示，且加 0 ；</p><p>-w ：行号栏位的占用的位数。</p><p>测试：</p><p>[root@kuangshen ~]# nl /etc/sysconfig/network-scripts/ifcfg-eth0<br>1DEVICE=eth0<br>2BOOTPROTO=dhcp<br>3ONBOOT=yes</p><blockquote><p>more  一页一页翻动</p></blockquote><p>在 more 这个程序的运行过程中，你有几个按键可以按的：</p><p>空白键 (space)：代表向下翻一页；</p><p>Enter     ：代表向下翻『一行』；</p><p>/字串     ：代表在这个显示的内容当中，向下搜寻『字串』这个关键字；</p><p>:f      ：立刻显示出档名以及目前显示的行数；</p><p>q       ：代表立刻离开 more ，不再显示该文件内容。</p><p>b 或 [ctrl]-b ：代表往回翻页，不过这动作只对文件有用，对管线无用。</p><pre><code>[root@kuangshen etc]# more /etc/csh.login....(中间省略)....--More--(28%) # 重点在这一行喔！你的光标也会在这里等待你的命令</code></pre><blockquote><p>less   一页一页翻动，以下实例输出/etc/man.config文件的内容：</p></blockquote><p>less运行时可以输入的命令有：</p><p>空白键  ：向下翻动一页；</p><p>[pagedown]：向下翻动一页；</p><p>[pageup] ：向上翻动一页；</p><p>/字串   ：向下搜寻『字串』的功能；</p><p>?字串   ：向上搜寻『字串』的功能；</p><p>n     ：重复前一个搜寻 (与 / 或 ? 有关！)</p><p>N     ：反向的重复前一个搜寻 (与 / 或 ? 有关！)</p><p>q     ：离开 less 这个程序；</p><pre><code>[root@kuangshen etc]# more /etc/csh.login....(中间省略)....:   # 这里可以等待你输入命令！</code></pre><blockquote><p>head  取出文件前面几行</p></blockquote><p>语法：</p><p>head [-n number] 文件<br>选项与参数：-n 后面接数字，代表显示几行的意思！</p><p>默认的情况中，显示前面 10 行！若要显示前 20 行，就得要这样：</p><p>[root@kuangshen etc]# head -n 20 /etc/csh.login</p><p>tail  取出文件后面几行</p><p>语法：</p><p>tail [-n number] 文件<br>选项与参数：</p><p>-n ：后面接数字，代表显示几行的意思</p><p>默认的情况中，显示最后 10 行！若要显示最后 20 行，就得要这样：</p><p>[root@kuangshen etc]# tail -n 20 /etc/csh.login</p><blockquote><p>拓展：Linux 链接概念</p></blockquote><p>Linux 链接分两种，一种被称为硬链接（Hard Link），另一种被称为符号链接（Symbolic Link）。</p><p>情况下，ln 命令产生硬链接。</p><p>硬连接</p><p>硬连接指通过索引节点来进行连接。在 Linux 的文件系统中，保存在磁盘分区中的文件不管是什么类型都给它分配一个编号，称为索引节点号(Inode Index)。在 Linux 中，多个文件名指向同一索引节点是存在的。比如：A 是 B 的硬链接（A 和 B 都是文件名），则 A 的目录项中的 inode 节点号与 B 的目录项中的 inode 节点号相同，即一个 inode 节点对应两个不同的文件名，两个文件名指向同一个文件，A 和 B 对文件系统来说是完全平等的。删除其中任何一个都不会影响另外一个的访问。</p><p>硬连接的作用是允许一个文件拥有多个有效路径名，这样用户就可以建立硬连接到重要文件，以防止“误删”的功能。其原因如上所述，因为对应该目录的索引节点有一个以上的连接。只删除一个连接并不影响索引节点本身和其它的连接，只有当最后一个连接被删除后，文件的数据块及目录的连接才会被释放。也就是说，文件真正删除的条件是与之相关的所有硬连接文件均被删除。</p><p>软连接</p><p>另外一种连接称之为符号连接（Symbolic Link），也叫软连接。软链接文件有类似于 Windows 的快捷方式。它实际上是一个特殊的文件。在符号连接中，文件实际上是一个文本文件，其中包含的有另一文件的位置信息。比如：A 是 B 的软链接（A 和 B 都是文件名），A 的目录项中的 inode 节点号与 B 的目录项中的 inode 节点号不相同，A 和 B 指向的是两个不同的 inode，继而指向两块不同的数据块。但是 A 的数据块中存放的只是 B 的路径名（可以根据这个找到 B 的目录项）。A 和 B 之间是“主从”关系，如果 B 被删除了，A 仍然存在（因为两个是不同的文件），但指向的是一个无效的链接。</p><p>测试：</p><pre><code>[root@kuangshen /]# cd /home[root@kuangshen home]# touch f1 # 创建一个测试文件f1[root@kuangshen home]# lsf1[root@kuangshen home]# ln f1 f2     # 创建f1的一个硬连接文件f2[root@kuangshen home]# ln -s f1 f3   # 创建f1的一个符号连接文件f3[root@kuangshen home]# ls -li       # -i参数显示文件的inode节点信息397247 -rw-r--r-- 2 root root     0 Mar 13 00:50 f1397247 -rw-r--r-- 2 root root     0 Mar 13 00:50 f2397248 lrwxrwxrwx 1 root root     2 Mar 13 00:50 f3 -&gt; f1</code></pre><p>从上面的结果中可以看出，硬连接文件 f2 与原文件 f1 的 inode 节点相同，均为 397247，然而符号连接文件的 inode 节点不同。</p><pre><code>#echo 字符串输出 &gt;&gt; f1 输出到 f1文件[root@kuangshen home]# echo "I am f1 file" &gt;&gt;f1[root@kuangshen home]# cat f1I am f1 file[root@kuangshen home]# cat f2I am f1 file[root@kuangshen home]# cat f3I am f1 file[root@kuangshen home]# rm -f f1[root@kuangshen home]# cat f2I am f1 file[root@kuangshen home]# cat f3cat: f3: No such file or directory</code></pre><p>通过上面的测试可以看出：当删除原始文件 f1 后，硬连接 f2 不受影响，但是符号连接 f1 文件无效；</p><p>依此您可以做一些相关的测试，可以得到以下全部结论：</p><p>删除符号连接f3,对f1,f2无影响；</p><p>删除硬连接f2，对f1,f3也无影响；</p><p>删除原文件f1，对硬连接f2没有影响，导致符号连接f3失效；</p><p>同时删除原文件f1,硬连接f2，整个文件会真正的被删除。</p>]]></content>
      
      
      <categories>
          
          <category> Markdown </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
            <tag> 指令 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>MySQL 学习总结</title>
      <link href="/2021/10/22/mysql-xue-xi-zong-jie/"/>
      <url>/2021/10/22/mysql-xue-xi-zong-jie/</url>
      
        <content type="html"><![CDATA[<h1 id="MySQL-学习总结"><a href="#MySQL-学习总结" class="headerlink" title="MySQL 学习总结"></a>MySQL 学习总结</h1><h1 id="1-基础知识"><a href="#1-基础知识" class="headerlink" title="1.基础知识"></a>1.基础知识</h1><h2 id="1-三大范式"><a href="#1-三大范式" class="headerlink" title="1.三大范式"></a>1.三大范式</h2><blockquote><p>第一范式：每个列不可拆</p><p>第二范式：在一的基础上，非主键列完全依赖主键列，不是依赖一部分</p><p>第三范式：在二的基础上，非主键列只能依赖主键列</p></blockquote><h2 id="2-mysql权限表"><a href="#2-mysql权限表" class="headerlink" title="2.mysql权限表"></a>2.mysql权限表</h2><blockquote><p>user权限表:用户信息</p><p>db权限表：账号权限信息</p><p>table_priv权限表：数据标记操作权限</p><p>host权限表：配合db对数据库操作权限做精细控制</p></blockquote><h2 id="3-数据库的数据类型"><a href="#3-数据库的数据类型" class="headerlink" title="3.数据库的数据类型"></a>3.数据库的数据类型</h2><blockquote><p>tinyint、smallint、 mediumint、int、 float、double、decimal、 时间类型、文本类型{varchar、char、text…}</p></blockquote><h2 id="4-两种数据库引擎的区别（innodb和MyISAM）"><a href="#4-两种数据库引擎的区别（innodb和MyISAM）" class="headerlink" title="4.两种数据库引擎的区别（innodb和MyISAM）"></a>4.两种数据库引擎的区别（innodb和MyISAM）</h2><p>存储结构：innodb所有表保存在同一个数据文件中：表保存在三个文件中（表格定义、数据文件、索引文件）</p><p>存储空间：innodb需要更多空间：可以被压缩，所需空间小</p><p>外键：支持：不支持</p><p>事务：支持：不支持</p><p>锁：支持行锁、表锁，页锁 ：只支持表级锁定</p><p>增删改操作：innodb更优秀</p><p>索引：支持hash索引但不支持全文索引：支持全文索引但不支持hash索引、</p><p>索引类型：聚簇索引：非聚簇索引</p><p>索引效率：索引的叶子节点存储的是数据值，效率高效：索引的叶子节点存储的是数据的地址值，需要再次寻址，效率一般</p><h2 id="5-innodb引擎四大特点"><a href="#5-innodb引擎四大特点" class="headerlink" title="5.innodb引擎四大特点"></a>5.innodb引擎四大特点</h2><p>插入缓冲、二次写、自适应哈希索引、预读</p><h1 id="2-索引"><a href="#2-索引" class="headerlink" title="2.索引"></a>2.索引</h1><h2 id="索引是什么-、优缺点"><a href="#索引是什么-、优缺点" class="headerlink" title="索引是什么 、优缺点"></a>索引是什么 、优缺点</h2><p>索引是一种记录的引用指针，是一种为了方便排序的数据结构。</p><p>优点：加快查询速度、提高数据库性能</p><p>缺点：需要维护、占据内存、影响增删改操作</p><h2 id="索引建立规则"><a href="#索引建立规则" class="headerlink" title="索引建立规则"></a>索引建立规则</h2><p>alter table  表名 add  index  索引名(字段名)</p><p>删除： alter table 表名 drop KEY 索引名</p><h2 id="索引类型"><a href="#索引类型" class="headerlink" title="索引类型"></a>索引类型</h2><p>主键索引、唯一索引、普通索引（可为null）、全文索引(alter table 表名 add fulltext (列名))</p><h2 id="索引数据结构"><a href="#索引数据结构" class="headerlink" title="索引数据结构"></a>索引数据结构</h2><p>mysql中有hash索引和b+树索引，innodb默认b+数索引。</p><h2 id="索引基本原理"><a href="#索引基本原理" class="headerlink" title="索引基本原理"></a>索引基本原理</h2><p>对创建索引的列排序生成倒排表、在倒排表上拼上数据地址链、查询时，先拿到倒排表内容，然后区根据数据地址拿到数据</p><h2 id="索引算法"><a href="#索引算法" class="headerlink" title="索引算法"></a>索引算法</h2><p>hash算法：只用于含有=号的比较 =、 &lt;=&gt; ，一次定位</p><p>bTree算法：范围查询 但是在like上面，只适合于   ：xxx%,即%必须在后面</p><h2 id="索引设计原则"><a href="#索引设计原则" class="headerlink" title="索引设计原则"></a>索引设计原则</h2><p>内容大的适合创建索引、一般在where语句后面的适合创建索引、不过度创建索引</p><h2 id="索引创建原则"><a href="#索引创建原则" class="headerlink" title="索引创建原则"></a>索引创建原则</h2><p>最左匹配原则：从左往右遍历，但是遇到范围查询就会停止匹配。（between、&lt;、&gt;、like）(a、b、c、d还是a、b、d、c)</p><p>可以说创建的idx_abc(a,b,c)索引，相当于创建了(a)、（a,b）（a,b,c）三个索引。</p><p>频繁查询的列才去创建</p><p>更新频繁不推荐</p><p>尽量扩展索引</p><p>定义有外键的列一定建立索引</p><p>文本类型的不建立索引</p><h2 id="索引一定能提高性能嘛？"><a href="#索引一定能提高性能嘛？" class="headerlink" title="索引一定能提高性能嘛？"></a>索引一定能提高性能嘛？</h2><p>不一定。需要空间存储、增删改数据时索引也需要改变，影响查询时间</p><h2 id="百万级数据怎么删除"><a href="#百万级数据怎么删除" class="headerlink" title="百万级数据怎么删除"></a>百万级数据怎么删除</h2><p>先删除索引、然后删除无用数据、重新创建索引</p><h2 id="前缀索引"><a href="#前缀索引" class="headerlink" title="前缀索引"></a>前缀索引</h2><p>alter table 表名 add index 索引名（field(10)）:使用于密码等。</p><h2 id="b树和b-数的区别"><a href="#b树和b-数的区别" class="headerlink" title="b树和b+数的区别"></a>b树和b+数的区别</h2><p>b树：键和值存在内部节点和子节点   b+树：内部节点都是键，叶子节点同时存放键和值</p><p>b+树的叶子节点有一条链相连接        b树的叶子节点各自独立</p><h2 id="b树的好处和b-树的好处"><a href="#b树的好处和b-树的好处" class="headerlink" title="b树的好处和b+树的好处"></a>b树的好处和b+树的好处</h2><p>b树：内部节点同时存储键和值。把频繁访问的数据放在靠近根节点附件会大大提高热点数据的查询</p><p>b+树：b+树的叶节点由一条链相连接。对全局遍历时，花费的时间更少。不需要层层遍历。</p><h2 id="索引使用b-树的好处"><a href="#索引使用b-树的好处" class="headerlink" title="索引使用b+树的好处"></a>索引使用b+树的好处</h2><p>b树只适合随机检索，b+树同时支持随机检索和顺序检索。</p><p>b+树空间利用率更高，减少i/o次数，读写代价低。</p><p>b+树查询效率更稳定。</p><p>b+树的叶子节点使用指针顺序连接，遍历叶子节点就实现对整棵树的遍历。</p><h2 id="聚簇索引"><a href="#聚簇索引" class="headerlink" title="聚簇索引"></a>聚簇索引</h2><p>在b+树中，叶子节点存储了当前的key和整行的数据，这就是聚簇索引。单纯存储key值的就是非聚簇索引。</p><p>只有主键索引是聚簇索引。当查询使用聚簇索引时，在对应的叶子节点可以获取整行的数据，不需要回表。</p><h2 id="联合索引"><a href="#联合索引" class="headerlink" title="联合索引"></a>联合索引</h2><p>在mysql中可以多个字段同时建立一个索引。但是需要按照建立索引时的字段顺序挨个使用，不然无法命中。</p><h1 id="3-事务"><a href="#3-事务" class="headerlink" title="3.事务"></a>3.事务</h1><h2 id="事务简介"><a href="#事务简介" class="headerlink" title="事务简介"></a>事务简介</h2><p>事务是一个不可分割的数据库操作顺序。事务是逻辑上的一组操作，要么执行，要么都不执行。</p><h2 id="事务特性"><a href="#事务特性" class="headerlink" title="事务特性"></a>事务特性</h2><p>原子性：最小执行单位</p><p>一致性：执行事务前后，数据保持一致</p><p>隔离性：一个事务不被其他事务干扰。各事务并发独立</p><p>持久性：对数据库中数据的改变是持久的。</p><p>原子性、一致性和持久性是通过数据库的redo log和undo log来完成，redo log称为重做日志，用来保证事务的原子性和持久性。undo log用来保证事务的一致性。 而隔离性是通过锁实现的。</p><h2 id="脏读、幻读、不可重复读"><a href="#脏读、幻读、不可重复读" class="headerlink" title="脏读、幻读、不可重复读"></a>脏读、幻读、不可重复读</h2><p>脏读：一个事务更新一个数据，另一个事务读取数据，但是更新数据的事务回滚了。（<strong>回滚</strong>）</p><p>幻读：一个事务查询数据，但是另一个事务同时插入了新的数据，事务读完后发现有几列数据是之前查询不存在的（<strong>执行两次相同事务</strong>）</p><p>不可重复读：一个事务中有两个查询，但是在执行第一个查询后有其他事务进行了更新操作，导致事务中的第二个查询和第一个不一致。（<strong>一个事务中有两次查询操作</strong>）</p><h2 id="mysql隔离级别"><a href="#mysql隔离级别" class="headerlink" title="mysql隔离级别"></a>mysql隔离级别</h2><p>读取未提交：脏读、幻读、不可重复读一个也不行</p><p>读取已提交：只能顶脏读</p><p>可重复度：能顶脏读和不可重复读</p><p>可串行化：serializable 都可以抵制 </p><p>mysql数据库默认级别为：读取已提交</p><h1 id="4-锁"><a href="#4-锁" class="headerlink" title="4.锁"></a>4.锁</h1><h2 id="锁的划分"><a href="#锁的划分" class="headerlink" title="锁的划分"></a>锁的划分</h2><p>表级锁：粒度最大、实现简单、消耗资源少，分为 表共享读锁和表独占写锁</p><p>行级锁：粒度最小，对行加锁，减少数据库操作冲突，但是开销大，分为共享锁和排它锁</p><p>页级锁：粒度介于之间，属于一种折中的选择。</p><h2 id="lock和latch区别"><a href="#lock和latch区别" class="headerlink" title="lock和latch区别"></a>lock和latch区别</h2><p>lock锁：锁的对象是事务，用于锁定数据库中的对象，如表、页、行等，lock锁一般在commit或rollback后释放，有死锁机制。</p><p>latch锁：轻量级锁，要求锁定的时间必须非常短，在InnoDB中又可以分为mutex(互斥量)和rwlock(读写锁)。</p><p>用来保证并发线程操作临界资源的正确性，通常没有死锁检测的机制。</p><h2 id="mysql锁的分类"><a href="#mysql锁的分类" class="headerlink" title="mysql锁的分类"></a>mysql锁的分类</h2><p>行锁：</p><p>​    共享锁：又叫做读锁，读取数据时，对数据加上共享锁。可以同时加上多个</p><p>​    排它锁：又叫做写锁。写入数据时，加上排它锁。只能加一个。和其他锁互斥。</p><p>​    总结：读可以一起读、但是写只能单个写。</p><p>非行锁：</p><p>​    表级锁：</p><p>​                意向锁：</p><p>​                        意向共享锁(IS Lock)：事务想要获得一张表中某几行的共享锁。</p><p>​                        意向排他锁(IX Lock)：事务想要获得一张表中某几行的排他锁。</p><h2 id="行锁怎么实现"><a href="#行锁怎么实现" class="headerlink" title="行锁怎么实现"></a>行锁怎么实现</h2><p>innodb基于索引进行加锁。只能对含有索引的行进行加锁。如果不是索引行，只能加表锁</p><p>使用关键字for update进行加锁。</p><p>select * from table_with_index where id = 1  <strong>for update</strong></p><p>select … for update和select … lock in share mode</p><h2 id="什么是一致性非锁定读-MVCC"><a href="#什么是一致性非锁定读-MVCC" class="headerlink" title="什么是一致性非锁定读**(MVCC)**"></a>什么是一致性非锁定读**(MVCC)**</h2><p>Multi-Version Concurrency Control：MVCC多版本并发控制，指的是一种提高并发的技术</p><p>最早的数据库系统，只有读读之间可以并发，读写，写读，写写都要阻塞。引入多版本之</p><p>后，<strong>只有写写之间相互阻塞</strong>，其他三种操作都可以并行。</p><h2 id="MVCC带来的好处是？"><a href="#MVCC带来的好处是？" class="headerlink" title="MVCC带来的好处是？"></a><strong>MVCC</strong>带来的好处是？</h2><p>在并发读写数据库时，可以做到在读操作时不用阻塞写操作，写操作也不用阻塞读操作，提高了数据库并发读写的性能</p><p>同时还可以解决脏读，幻读，不可重复读等事务隔离问题，但不能解决更新丢失问题</p><p>MVCC常见的实现方式乐观锁和悲观锁</p><h2 id="死锁"><a href="#死锁" class="headerlink" title="死锁"></a>死锁</h2><p>多个事务在同一资源上相互占用，请求并锁定对方资源，从而导致恶性循环等待现象。</p><p>解决方法：尽量约定以相同顺序访问表、同一事务中，尽量一次锁定需要的所有资源、尝试使用升级锁定颗粒度，</p><p>通过表级锁定减少死锁的概率。</p><h2 id="乐观和悲观锁、怎么实现"><a href="#乐观和悲观锁、怎么实现" class="headerlink" title="乐观和悲观锁、怎么实现"></a>乐观和悲观锁、怎么实现</h2><p>悲观：假设会发生冲突，在查询完数据的时候就把事务锁起来，知道提交事务。实现方式：使用数据库的锁机制</p><p>乐观：假设不会发生冲突，在修改数据的时候才把事务锁起来，通过version的版本进行锁定实现方式：CSA算法实现或使用版本号。</p><p>乐观使用于多读取的情况，悲观适用于多写的情况。</p><h1 id="5-视图"><a href="#5-视图" class="headerlink" title="5.视图"></a>5.视图</h1><h2 id="什么是视图、好处、缺点"><a href="#什么是视图、好处、缺点" class="headerlink" title="什么是视图、好处、缺点"></a>什么是视图、好处、缺点</h2><p>视图是一种虚拟表，物理上不存在。包含一系列带有名称的列和行数据。</p><p>好处：提高sql语句的复用性和操作安全性。</p><p>缺点：视图生成花费时间、占用性能。视图的删除和修改有限制。</p><h2 id="视图特点"><a href="#视图特点" class="headerlink" title="视图特点"></a>视图特点</h2><p>视图的列可以来自不同的表、视图是由基本表产生的虚表、对视图的操作直接影响基本表、</p><p>视图来自多个基本表时，不能删除和添加数据。</p><h1 id="常用查询语句"><a href="#常用查询语句" class="headerlink" title="常用查询语句"></a>常用查询语句</h1><h2 id="sql分类"><a href="#sql分类" class="headerlink" title="sql分类"></a>sql分类</h2><p>DDL语言（对表进行改变）：alter、drop、create</p><p>DQL语言（查询语句）：select</p><p>DML语言（对数据操作）：insert、delete、update</p><p>DCL语言(对数据库安全操作)：grant、revoke、commit、rollback</p><h2 id="sql约束有哪些"><a href="#sql约束有哪些" class="headerlink" title="sql约束有哪些"></a>sql约束有哪些</h2><p>not null、unique、primary key、foreign key 、check</p><h2 id="mysql中的in和exists的区别"><a href="#mysql中的in和exists的区别" class="headerlink" title="mysql中的in和exists的区别"></a>mysql中的in和exists的区别</h2><p>in语句是吧外表和内表做hash连接、exists是对外表做loop循环</p><p>内外两个表差不多大，in和exists差不多。子查询表大的用exists，子查询表小的用in</p><p>not in 和not exists：not in 不能用索引了，但是not exists可以使用索引。索引not exists更快。</p><h1 id="sql-优化"><a href="#sql-优化" class="headerlink" title="sql 优化"></a><strong>sql 优化</strong></h1><h2 id=""><a href="#" class="headerlink" title=""></a></h2>]]></content>
      
      
      <categories>
          
          <category> 数据库 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 数据库 </tag>
            
            <tag> 总结 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>renren-generator逆向工程学习</title>
      <link href="/2021/10/22/renren-generator-ni-xiang-gong-cheng-xue-xi/"/>
      <url>/2021/10/22/renren-generator-ni-xiang-gong-cheng-xue-xi/</url>
      
        <content type="html"><![CDATA[<h1 id="源码地址"><a href="#源码地址" class="headerlink" title="源码地址"></a>源码地址</h1><p><a href="https://gitee.com/renrenio/renren-generator">renren-generator</a><br>本地部署</p><ul><li>通过git下载源码</li><li>修改application.yml，更新MySQL账号和密码、数据库名称</li><li>Eclipse、IDEA运行RenrenApplication.java，则可启动项目</li><li>项目访问路径：<a href="http://localhost/">http://localhost</a><h1 id="修改源码里的application数据库地址"><a href="#修改源码里的application数据库地址" class="headerlink" title="修改源码里的application数据库地址"></a>修改源码里的application数据库地址</h1></li></ul><pre class=" language-java"><code class="language-java">spring<span class="token operator">:</span>  datasource<span class="token operator">:</span>    type<span class="token operator">:</span> com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>druid<span class="token punctuation">.</span>pool<span class="token punctuation">.</span>DruidDataSource    #MySQL配置    driverClassName<span class="token operator">:</span> com<span class="token punctuation">.</span>mysql<span class="token punctuation">.</span>jdbc<span class="token punctuation">.</span>Driver    url<span class="token operator">:</span> jdbc<span class="token operator">:</span>mysql<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span><span class="token number">101.35</span><span class="token punctuation">.</span><span class="token number">103.140</span><span class="token operator">/</span>gulimall_oms<span class="token operator">?</span>useUnicode<span class="token operator">=</span><span class="token boolean">true</span><span class="token operator">&amp;</span>characterEncoding<span class="token operator">=</span>UTF<span class="token operator">-</span><span class="token number">8</span><span class="token operator">&amp;</span>useSSL<span class="token operator">=</span><span class="token boolean">false</span>    username<span class="token operator">:</span> root    password<span class="token operator">:</span> root</code></pre><h1 id="修改源码里的generator-properties文件"><a href="#修改源码里的generator-properties文件" class="headerlink" title="修改源码里的generator.properties文件"></a>修改源码里的generator.properties文件</h1><pre class=" language-java"><code class="language-java">#项目工程名mainPath<span class="token operator">=</span>com<span class="token punctuation">.</span>atguigu#项目包名<span class="token keyword">package</span><span class="token operator">=</span>com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>gulimall#模块名moduleName<span class="token operator">=</span>order#\u4F5C\u8005#作者author<span class="token operator">=</span>ggc#Emailemail<span class="token operator">=</span>ggc#\u8868\u524D\<span class="token function">u7F00</span><span class="token punctuation">(</span>\u7C7B\u540D\u4E0D\u4F1A\u5305\u542B\u8868\u524D\u7F00<span class="token punctuation">)</span>#数据库表前缀tablePrefix<span class="token operator">=</span>oms_</code></pre>]]></content>
      
      
      <categories>
          
          <category> Markdown </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 逆向工程 </tag>
            
            <tag> 开发工具 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>redis学习笔记</title>
      <link href="/2021/10/22/redis-xue-xi-bi-ji/"/>
      <url>/2021/10/22/redis-xue-xi-bi-ji/</url>
      
        <content type="html"><![CDATA[<h1 id="1-为什么要用Nosql"><a href="#1-为什么要用Nosql" class="headerlink" title="1.为什么要用Nosql"></a>1.为什么要用Nosql</h1><h2 id="1-1用户的个人信息，社交网络，地理位置。用户自己产生的数据，用户日志等等爆发式增长！"><a href="#1-1用户的个人信息，社交网络，地理位置。用户自己产生的数据，用户日志等等爆发式增长！" class="headerlink" title="1.1用户的个人信息，社交网络，地理位置。用户自己产生的数据，用户日志等等爆发式增长！"></a>1.1用户的个人信息，社交网络，地理位置。用户自己产生的数据，用户日志等等爆发式增长！</h2><h2 id="1-2-什么是NoSql"><a href="#1-2-什么是NoSql" class="headerlink" title="1.2 什么是NoSql"></a>1.2 什么是NoSql</h2><h3 id="Not-Only-Sql-不仅仅是sql"><a href="#Not-Only-Sql-不仅仅是sql" class="headerlink" title="Not Only Sql 不仅仅是sql"></a>Not Only Sql 不仅仅是sql</h3><blockquote><p>NoSQL仅仅是一个概念，泛指非关系型的数据库，区别于关系数据库，它们不保证关系数据的ACID特性。NoSQL是一项全新的数据库革命性运动，其拥护者们提倡运用非关系型的数据存储，相对于铺天盖地的关系型数据库运用，这一概念无疑是一种全新的思维的注入解耦</p></blockquote><p>1.方便扩展（数据之间没有关系，很好扩展）<br>2.大数据量高性能（Redis一秒写8万次，读11万，NoSQL的缓存记录级，是一种细粒度的缓存，性能会比较高）<br>3.数据类型是多样型的！（不需要事先设计数据库！随取随用！如果是数据量十分大的表，很多人就无法设计了）<br>4.传统的RDBMS和NoSQL</p><ul><li>传统的RDBMS<ul><li>机构化组织</li><li>SQL</li><li>数据克关系都存在单独的表中 row col</li><li>数据定义语言</li><li>基础的事务</li></ul></li><li>NoSQL<ul><li>不仅仅是数据</li><li>没有固定的查询语言</li><li>键值对存储，列存储，文档存储，图形数据库（社交关系）</li><li>最终一致性</li><li>CAP定理和BASE（异地多活）</li><li>高性能，高可用，高可拓</li></ul></li></ul><p>了解：3V+3高大数据时代的3V：主要是描述问题的<br>海量Volume<br>多样Variety<br>实时Velocity</p><p>大数据时代的3高：主要是对程序的要求<br>高并发<br>高可拓<br>高性能</p><h3 id="1-3、NoSQL的四大分类"><a href="#1-3、NoSQL的四大分类" class="headerlink" title="1.3、NoSQL的四大分类"></a>1.3、NoSQL的四大分类</h3><p>KV键值对：</p><ul><li>新浪：Redis</li><li>美团：Redis + Tair</li><li>阿里、百度：Redis + memecache</li><li>文档型数据库（bson格式和json一样）：</li></ul><ul><li>MongoDB<ul><li>MongoDB是一个基于分布式文件存储的数据库，C++编写，主要用来处理大量的文档！</li><li>MongoDB是一个介于关系型数据库和非关系型数据中间的产品，MongoDB是非关系型数据库中功能最丰富，最像关系型数据库的</li><li>ConthDB</li><li>列存储数据库</li></ul></li></ul><ul><li>HBsae</li><li>分布式文件系统</li><li>图关系数据库</li><li>他不是存图形，放的是关系，比如：朋友圈社交网络，广告推荐</li><li>Neo4j，InfoGrid<br><img src="https://edu-2539.oss-cn-beijing.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E5%9B%BE%E7%89%87/20210322211739805.png" alt="image"></li></ul><h1 id="2-Redis-入门"><a href="#2-Redis-入门" class="headerlink" title="2.Redis 入门"></a>2.Redis 入门</h1><h2 id="2-1-概念"><a href="#2-1-概念" class="headerlink" title="2.1 概念"></a>2.1 概念</h2><blockquote><p>redis 是什么</p></blockquote><p>Redis（Remote Dictionary Server )，即远程字典服务，是一个开源的使用ANSI C语言编写、支持网络、可基于内存亦可持久化的日志型、Key-Value数据库，并提供多种语言的API<br>redis会周期性的把更新的数据写入磁盘或者把修改操作写入追加的记录文件，并且在此基础上实现了master-slave(主从)同步。</p><blockquote><p>redis 能干嘛</p></blockquote><p>1、内存存储、持久化，内存断电即失，持久化很重要（rdb，aof）<br>2、效率高，可以用于告诉缓存<br>3、发布订阅系统<br>4、地图信息分析<br>5、计时器、计数器（浏览量）<br>6…</p><blockquote><p>特性</p></blockquote><p>1、多样的数据类型<br>2、持久化<br>3、集群<br>4、事务<br>…</p><p>官网：<a href="https://redis.io/">https://redis.io/</a><br>中文网：<a href="http://www.redis.cn/">http://www.redis.cn/</a></p><h2 id="2-2-基本环境搭建"><a href="#2-2-基本环境搭建" class="headerlink" title="2.2 基本环境搭建"></a>2.2 基本环境搭建</h2><p>1.下载linux安装包，本文下载的为5.0.12（6.0以上的需要升级gcc，太费劲）<br>2.将redis-5.0.12.tar.gz，传输到opt目录（当然了，不喜欢opt目录其它目录也可以）<br>3.解压 tar -zxvf redis-5.0.12.tar.gz</p><pre class=" language-java"><code class="language-java">tar <span class="token operator">-</span>zxvf redis<span class="token operator">-</span><span class="token number">5.0</span><span class="token punctuation">.</span><span class="token number">12</span><span class="token punctuation">.</span>tar<span class="token punctuation">.</span>gz</code></pre><p>4.安装gcc</p><pre class=" language-java"><code class="language-java">yum <span class="token operator">-</span>y install gcc gcc<span class="token operator">-</span>c<span class="token operator">++</span>yum install gcc<span class="token operator">-</span>c<span class="token operator">++</span> tcl</code></pre><p>5.进入到redis解压下的目录，执行make</p><pre class=" language-java"><code class="language-java">cd <span class="token operator">/</span>opt<span class="token operator">/</span>redis<span class="token operator">-</span><span class="token number">5.0</span><span class="token punctuation">.</span><span class="token number">12</span>make</code></pre><ol start="6"><li>进入到redis默认安装路径：/usr/local/bin下，查看是否安装完成<br><img src="https://edu-2539.oss-cn-beijing.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E5%9B%BE%E7%89%87/20210323200949703.png" alt="image"></li><li>创建文件夹，用来保存redis的配置文件，并将解压包内的redis.conf，拷贝一份，后续按照拷贝后的文件进行启动</li></ol><pre class=" language-java"><code class="language-java">mkdir <span class="token operator">/</span>usr<span class="token operator">/</span>local<span class="token operator">/</span>bin<span class="token operator">/</span>redisconfigcp cp <span class="token operator">/</span>opt<span class="token operator">/</span>redis<span class="token operator">-</span><span class="token number">5.0</span><span class="token punctuation">.</span><span class="token number">12</span><span class="token operator">/</span>redis<span class="token punctuation">.</span>conf <span class="token operator">/</span>usr<span class="token operator">/</span>local<span class="token operator">/</span>bin<span class="token operator">/</span>redisconfig<span class="token operator">/</span></code></pre><ol start="8"><li><p>更改配置文件，配置后台启动<br><img src="https://edu-2539.oss-cn-beijing.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E5%9B%BE%E7%89%87/20210323201349704.png" alt="image"></p></li><li><p>用拷贝过来的配置文件启动redis</p></li></ol><pre><code>redis-server redisconfig/redis.conf</code></pre><ol start="10"><li>客户端连接</li></ol><pre><code>redis-cli -p 6379</code></pre><ol start="11"><li>查看redis进程</li></ol><pre><code>ps -ef|grep redis</code></pre><ol start="12"><li>关闭redis</li></ol><pre><code>shutdownexit</code></pre><h2 id="2-3-性能测试"><a href="#2-3-性能测试" class="headerlink" title="2.3 性能测试"></a>2.3 性能测试</h2><p>Redis性能压测工具 redis-benchmark<br><img src="https://edu-2539.oss-cn-beijing.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E5%9B%BE%E7%89%87/20210323202832713.png" alt="image"></p><h2 id="2-4、redis基础知识"><a href="#2-4、redis基础知识" class="headerlink" title="2.4、redis基础知识"></a>2.4、redis基础知识</h2><p>redis默认有16个数据库，默认使用第0个</p><blockquote><p>Redis是单线程的！<br>Redis是很快的，官方表示，Redis是基于内存操作，CPU不是Redis性能瓶颈，Redis的瓶颈是根据机器的内存和网络带宽，既然可以用单线程来实现，就使用单线程了<br>Redis是C语言写的，官方提供的数据为100000+的QPS，完全不必同样是使用key-value的Memecache差！</p></blockquote><p>Redis为什么是单线程还这么快？</p><blockquote><p>误区1：高性能的服务器一定是多线程的？<br>误区2：多线程（CPU上下文会切换！）一定比单线程效率高？</p></blockquote><p>核心：&nbsp;redis是将所有的数据全部存放在内存中的，所以说使用单线程去操作效率就是最高的，多线程（CPU会上下文切换：耗时操作！）<br>对于内存系统来说，如果没有上下文切换，<br>效率就是最高的，多次读写都是在一个cpu上的，在内存情况下，这个就是最优的方案！</p><h3 id="2-4-1、redis常用命令"><a href="#2-4-1、redis常用命令" class="headerlink" title="2.4.1、redis常用命令"></a>2.4.1、redis常用命令</h3><pre class=" language-java"><code class="language-java">#<span class="token number">1</span><span class="token punctuation">.</span>切换数据库  select indexselect <span class="token number">3</span>#<span class="token number">2</span><span class="token punctuation">.</span>数据库大小dbsize#<span class="token number">3</span><span class="token punctuation">.</span> 查看所有的keykeys <span class="token operator">*</span>#<span class="token number">4</span><span class="token punctuation">.</span> 清空全部flushall#<span class="token number">5</span><span class="token punctuation">.</span> 清空当前库flushdb#<span class="token number">6</span><span class="token punctuation">.</span>判断某个key是否存在  EXISTS KEY#<span class="token number">7</span><span class="token punctuation">.</span>移某个keymove keyName 数据库index  （move name <span class="token number">1</span>）#<span class="token number">8</span><span class="token punctuation">.</span>设置key过期时间EXPIRE keyName seconds#<span class="token number">9</span><span class="token punctuation">.</span>查询有效期还剩多久ttl keyName#<span class="token number">10</span><span class="token punctuation">.</span>查看key类型type keyName</code></pre><h1 id="3、五大数据类型"><a href="#3、五大数据类型" class="headerlink" title="3、五大数据类型"></a>3、五大数据类型</h1><p>Redis 是一个开源（BSD许可）的，内存中的数据结构存储系统，它可以用作数据库、缓存和消息中间件。 它支持多种类型的数据结构，如 字符串（strings），<br>散列（hashes）， 列表（lists）， 集合（sets）， 有序集合（sorted sets） 与范围查询， bitmaps， hyperloglogs 和 地理空间（geospatial）<br>索引半径查询。 Redis 内置了 复制（replication），LUA脚本（Lua scripting）， LRU驱动事件（LRU eviction），事务（transactions） 和不同级别的<br>磁盘持久化（persistence）， 并通过 Redis哨兵（Sentinel）和自动 分区（Cluster）提供高可用性（high availability）。</p><h2 id="3-1、String"><a href="#3-1、String" class="headerlink" title="3.1、String"></a>3.1、String</h2><pre class=" language-java"><code class="language-java">####################################################################<span class="token number">127.0</span><span class="token punctuation">.</span><span class="token number">0.1</span><span class="token operator">:</span><span class="token number">6379</span><span class="token operator">></span> APPEND name aa #追加，如果追加的key不存在，则新建<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">6</span><span class="token number">127.0</span><span class="token punctuation">.</span><span class="token number">0.1</span><span class="token operator">:</span><span class="token number">6379</span><span class="token operator">></span> GET name<span class="token string">"yangaa"</span><span class="token number">127.0</span><span class="token punctuation">.</span><span class="token number">0.1</span><span class="token operator">:</span><span class="token number">6379</span><span class="token operator">></span> STRLEN name #获取key对应值的长度<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">6</span>####################################################################<span class="token number">127.0</span><span class="token punctuation">.</span><span class="token number">0.1</span><span class="token operator">:</span><span class="token number">6379</span><span class="token operator">></span> set views <span class="token number">0</span> #初始浏览量为<span class="token number">0</span>OK<span class="token number">127.0</span><span class="token punctuation">.</span><span class="token number">0.1</span><span class="token operator">:</span><span class="token number">6379</span><span class="token operator">></span> get views<span class="token string">"0"</span><span class="token number">127.0</span><span class="token punctuation">.</span><span class="token number">0.1</span><span class="token operator">:</span><span class="token number">6379</span><span class="token operator">></span> INCR views #自<span class="token operator">+</span><span class="token function">1</span><span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span><span class="token number">127.0</span><span class="token punctuation">.</span><span class="token number">0.1</span><span class="token operator">:</span><span class="token number">6379</span><span class="token operator">></span> get views<span class="token string">"1"</span><span class="token number">127.0</span><span class="token punctuation">.</span><span class="token number">0.1</span><span class="token operator">:</span><span class="token number">6379</span><span class="token operator">></span> DECR <span class="token function">views</span><span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">0</span><span class="token number">127.0</span><span class="token punctuation">.</span><span class="token number">0.1</span><span class="token operator">:</span><span class="token number">6379</span><span class="token operator">></span> get views #自<span class="token operator">-</span><span class="token number">1</span><span class="token string">"0"</span><span class="token number">127.0</span><span class="token punctuation">.</span><span class="token number">0.1</span><span class="token operator">:</span><span class="token number">6379</span><span class="token operator">></span> INCRBY views <span class="token number">10</span> #自<span class="token operator">+</span><span class="token function">10</span><span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">10</span><span class="token number">127.0</span><span class="token punctuation">.</span><span class="token number">0.1</span><span class="token operator">:</span><span class="token number">6379</span><span class="token operator">></span> get views<span class="token string">"10"</span><span class="token number">127.0</span><span class="token punctuation">.</span><span class="token number">0.1</span><span class="token operator">:</span><span class="token number">6379</span><span class="token operator">></span> DECRBY views <span class="token number">5</span> #自<span class="token operator">-</span><span class="token function">5</span><span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">5</span><span class="token number">127.0</span><span class="token punctuation">.</span><span class="token number">0.1</span><span class="token operator">:</span><span class="token number">6379</span><span class="token operator">></span> get views<span class="token string">"5"</span>####################################################################<span class="token number">127.0</span><span class="token punctuation">.</span><span class="token number">0.1</span><span class="token operator">:</span><span class="token number">6379</span><span class="token operator">></span> set key1 hello<span class="token punctuation">,</span>yangOK<span class="token number">127.0</span><span class="token punctuation">.</span><span class="token number">0.1</span><span class="token operator">:</span><span class="token number">6379</span><span class="token operator">></span> get key1<span class="token string">"hello,yang"</span><span class="token number">127.0</span><span class="token punctuation">.</span><span class="token number">0.1</span><span class="token operator">:</span><span class="token number">6379</span><span class="token operator">></span> GETRANGE key1 <span class="token number">0</span> <span class="token number">3</span> #截取字符串<span class="token string">"hell"</span><span class="token number">127.0</span><span class="token punctuation">.</span><span class="token number">0.1</span><span class="token operator">:</span><span class="token number">6379</span><span class="token operator">></span> GETRANGE key1 <span class="token number">0</span> <span class="token operator">-</span><span class="token number">1</span> #截取全部<span class="token string">"hello,yang"</span><span class="token number">127.0</span><span class="token punctuation">.</span><span class="token number">0.1</span><span class="token operator">:</span><span class="token number">6379</span><span class="token operator">></span> set key2 abcdOK<span class="token number">127.0</span><span class="token punctuation">.</span><span class="token number">0.1</span><span class="token operator">:</span><span class="token number">6379</span><span class="token operator">></span> SETRANGE key2 <span class="token number">1</span> xx <span class="token operator">&amp;</span>nbsp<span class="token punctuation">;</span>#替换 <span class="token operator">&amp;</span>nbsp<span class="token punctuation">;</span> SETRANGE key offset <span class="token function">value</span><span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">4</span><span class="token number">127.0</span><span class="token punctuation">.</span><span class="token number">0.1</span><span class="token operator">:</span><span class="token number">6379</span><span class="token operator">></span> get key2<span class="token string">"axxd"</span>##################################################################### <span class="token function">setex</span> <span class="token punctuation">(</span>set with expire<span class="token punctuation">)</span> 设置过期时间# <span class="token function">setnx</span> <span class="token punctuation">(</span>set <span class="token keyword">if</span> not exist<span class="token punctuation">)</span> 不存在才设置（在分布式锁中会常常使用）<span class="token number">27.0</span><span class="token punctuation">.</span><span class="token number">0.1</span><span class="token operator">:</span><span class="token number">6379</span><span class="token operator">></span> setex key3 <span class="token number">30</span> <span class="token string">"hello"</span> <span class="token operator">&amp;</span>nbsp<span class="token punctuation">;</span>#设置过期时间OK<span class="token number">127.0</span><span class="token punctuation">.</span><span class="token number">0.1</span><span class="token operator">:</span><span class="token number">6379</span><span class="token operator">></span> ttl <span class="token function">key3</span><span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">24</span><span class="token number">127.0</span><span class="token punctuation">.</span><span class="token number">0.1</span><span class="token operator">:</span><span class="token number">6379</span><span class="token operator">></span> setnx mykey <span class="token string">"redis"</span> #此时mykey不存在才能设置成功<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span><span class="token number">127.0</span><span class="token punctuation">.</span><span class="token number">0.1</span><span class="token operator">:</span><span class="token number">6379</span><span class="token operator">></span> keys <span class="token operator">*</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">"key1"</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">"mykey"</span><span class="token number">3</span><span class="token punctuation">)</span> <span class="token string">"key2"</span><span class="token number">127.0</span><span class="token punctuation">.</span><span class="token number">0.1</span><span class="token operator">:</span><span class="token number">6379</span><span class="token operator">></span> ttl <span class="token function">key3</span><span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token number">2</span><span class="token number">127.0</span><span class="token punctuation">.</span><span class="token number">0.1</span><span class="token operator">:</span><span class="token number">6379</span><span class="token operator">></span> setnx mykey <span class="token string">"MongoDB"</span> #此时mykey已存在设置不成功<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">0</span><span class="token number">127.0</span><span class="token punctuation">.</span><span class="token number">0.1</span><span class="token operator">:</span><span class="token number">6379</span><span class="token operator">></span> get mykey<span class="token string">"redis"</span>#####################################################################批量set，批量获取，批量不存在set<span class="token number">127.0</span><span class="token punctuation">.</span><span class="token number">0.1</span><span class="token operator">:</span><span class="token number">6379</span><span class="token operator">></span> mset k1 v1 k2 v2OK<span class="token number">127.0</span><span class="token punctuation">.</span><span class="token number">0.1</span><span class="token operator">:</span><span class="token number">6379</span><span class="token operator">></span> mget k1 k2<span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">"v1"</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">"v2"</span><span class="token number">127.0</span><span class="token punctuation">.</span><span class="token number">0.1</span><span class="token operator">:</span><span class="token number">6379</span><span class="token operator">></span> MSETNX k1 v2 k3 <span class="token function">v3</span><span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">0</span><span class="token number">127.0</span><span class="token punctuation">.</span><span class="token number">0.1</span><span class="token operator">:</span><span class="token number">6379</span><span class="token operator">></span> keys <span class="token operator">*</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">"k2"</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">"k1"</span>####################################################################set user<span class="token operator">:</span><span class="token number">1</span> <span class="token punctuation">{</span>name<span class="token operator">:</span>zhangsan<span class="token punctuation">,</span>age<span class="token operator">:</span><span class="token number">20</span><span class="token punctuation">}</span> #设置一个user<span class="token operator">:</span><span class="token number">1</span> 对象mset user<span class="token operator">:</span><span class="token number">1</span><span class="token operator">:</span>name zhangsan user<span class="token operator">:</span><span class="token number">1</span><span class="token operator">:</span>age <span class="token number">20</span>mget user<span class="token operator">:</span><span class="token number">1</span><span class="token operator">:</span>name user<span class="token operator">:</span><span class="token number">1</span><span class="token operator">:</span>age####################################################################getset #先get然后再set<span class="token number">127.0</span><span class="token punctuation">.</span><span class="token number">0.1</span><span class="token operator">:</span><span class="token number">6379</span><span class="token operator">></span> getset key1 redis #如果不存在则返回<span class="token function">nil</span><span class="token punctuation">(</span>nil<span class="token punctuation">)</span><span class="token number">127.0</span><span class="token punctuation">.</span><span class="token number">0.1</span><span class="token operator">:</span><span class="token number">6379</span><span class="token operator">></span> get key1<span class="token string">"redis"</span><span class="token number">127.0</span><span class="token punctuation">.</span><span class="token number">0.1</span><span class="token operator">:</span><span class="token number">6379</span><span class="token operator">></span> getset key1 mongodb<span class="token string">"redis"</span><span class="token number">127.0</span><span class="token punctuation">.</span><span class="token number">0.1</span><span class="token operator">:</span><span class="token number">6379</span><span class="token operator">></span> get key1<span class="token string">"mongodb"</span>####################################################################</code></pre><p>String类似的使用场景：value除了是我们的字符串还可以是我们的数字</p><ul><li>计数器</li><li>统计多单位的数量</li><li>粉丝数</li><li>对象缓存存储</li></ul><h2 id="3-2-List"><a href="#3-2-List" class="headerlink" title="3.2 List"></a>3.2 List</h2><pre class=" language-java"><code class="language-java"><span class="token number">127.0</span><span class="token punctuation">.</span><span class="token number">0.1</span><span class="token operator">:</span><span class="token number">6379</span><span class="token operator">></span> LPUSH list one #将一个值或多个值，插入到列表头部（左）<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span><span class="token number">127.0</span><span class="token punctuation">.</span><span class="token number">0.1</span><span class="token operator">:</span><span class="token number">6379</span><span class="token operator">></span> LPUSH list <span class="token function">two</span><span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">2</span><span class="token number">127.0</span><span class="token punctuation">.</span><span class="token number">0.1</span><span class="token operator">:</span><span class="token number">6379</span><span class="token operator">></span> LPUSH list <span class="token function">three</span><span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">3</span><span class="token number">127.0</span><span class="token punctuation">.</span><span class="token number">0.1</span><span class="token operator">:</span><span class="token number">6379</span><span class="token operator">></span> LRANGE list <span class="token number">0</span> <span class="token operator">-</span><span class="token number">1</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">"three"</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">"two"</span><span class="token number">3</span><span class="token punctuation">)</span> <span class="token string">"one"</span><span class="token number">127.0</span><span class="token punctuation">.</span><span class="token number">0.1</span><span class="token operator">:</span><span class="token number">6379</span><span class="token operator">></span> LRANGE list <span class="token number">0</span> <span class="token number">1</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">"three"</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">"two"</span><span class="token number">127.0</span><span class="token punctuation">.</span><span class="token number">0.1</span><span class="token operator">:</span><span class="token number">6379</span><span class="token operator">></span> RPUSH list four #将一个值或多个值，插入到列表尾部（右）<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">4</span><span class="token number">127.0</span><span class="token punctuation">.</span><span class="token number">0.1</span><span class="token operator">:</span><span class="token number">6379</span><span class="token operator">></span> LRANGE list <span class="token number">0</span> <span class="token operator">-</span><span class="token number">1</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">"three"</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">"two"</span><span class="token number">3</span><span class="token punctuation">)</span> <span class="token string">"one"</span><span class="token number">4</span><span class="token punctuation">)</span> <span class="token string">"four"</span>####################################################LPOP key 从左侧移除一个值RPOP key 从右侧移除一个值LREM key count value 从key中移除count个value<span class="token number">127.0</span><span class="token punctuation">.</span><span class="token number">0.1</span><span class="token operator">:</span><span class="token number">6379</span><span class="token operator">></span> LRANGE list <span class="token number">0</span> <span class="token operator">-</span><span class="token number">1</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">"three"</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">"two"</span><span class="token number">3</span><span class="token punctuation">)</span> <span class="token string">"one"</span><span class="token number">4</span><span class="token punctuation">)</span> <span class="token string">"four"</span><span class="token number">127.0</span><span class="token punctuation">.</span><span class="token number">0.1</span><span class="token operator">:</span><span class="token number">6379</span><span class="token operator">></span> LPOP list<span class="token string">"three"</span><span class="token number">127.0</span><span class="token punctuation">.</span><span class="token number">0.1</span><span class="token operator">:</span><span class="token number">6379</span><span class="token operator">></span> LRANGE list <span class="token number">0</span> <span class="token operator">-</span><span class="token number">1</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">"two"</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">"one"</span><span class="token number">3</span><span class="token punctuation">)</span> <span class="token string">"four"</span><span class="token number">127.0</span><span class="token punctuation">.</span><span class="token number">0.1</span><span class="token operator">:</span><span class="token number">6379</span><span class="token operator">></span> RPOP list<span class="token string">"four"</span><span class="token number">127.0</span><span class="token punctuation">.</span><span class="token number">0.1</span><span class="token operator">:</span><span class="token number">6379</span><span class="token operator">></span> LRANGE list <span class="token number">0</span> <span class="token operator">-</span><span class="token number">1</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">"two"</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">"one"</span>####################################################LINDEX 通过下角标求值<span class="token number">127.0</span><span class="token punctuation">.</span><span class="token number">0.1</span><span class="token operator">:</span><span class="token number">6379</span><span class="token operator">></span> LRANGE list <span class="token number">0</span> <span class="token operator">-</span><span class="token number">1</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">"two"</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">"one"</span><span class="token number">127.0</span><span class="token punctuation">.</span><span class="token number">0.1</span><span class="token operator">:</span><span class="token number">6379</span><span class="token operator">></span> LINDEX list <span class="token number">0</span><span class="token string">"two"</span><span class="token number">127.0</span><span class="token punctuation">.</span><span class="token number">0.1</span><span class="token operator">:</span><span class="token number">6379</span><span class="token operator">></span> LRANGE list <span class="token number">0</span> <span class="token operator">-</span><span class="token number">1</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">"one"</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">"one"</span><span class="token number">3</span><span class="token punctuation">)</span> <span class="token string">"two"</span><span class="token number">4</span><span class="token punctuation">)</span> <span class="token string">"one"</span><span class="token number">127.0</span><span class="token punctuation">.</span><span class="token number">0.1</span><span class="token operator">:</span><span class="token number">6379</span><span class="token operator">></span> LREM list <span class="token number">1</span> one #从list中移除<span class="token number">1</span>个<span class="token function">one</span><span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span><span class="token number">127.0</span><span class="token punctuation">.</span><span class="token number">0.1</span><span class="token operator">:</span><span class="token number">6379</span><span class="token operator">></span> LRANGE list <span class="token number">0</span> <span class="token operator">-</span><span class="token number">1</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">"one"</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">"two"</span><span class="token number">3</span><span class="token punctuation">)</span> <span class="token string">"one"</span>####################################################LLEN 求list长度LTRIM key start end  #截取####################################################RPOPLPUSH source destaintion #移除列表最后一个元素，将它移至目标key中<span class="token number">127.0</span><span class="token punctuation">.</span><span class="token number">0.1</span><span class="token operator">:</span><span class="token number">6379</span><span class="token operator">></span> RPUSH list <span class="token string">"hello1"</span><span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span><span class="token number">127.0</span><span class="token punctuation">.</span><span class="token number">0.1</span><span class="token operator">:</span><span class="token number">6379</span><span class="token operator">></span> RPUSH list <span class="token string">"hello2"</span><span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">2</span><span class="token number">127.0</span><span class="token punctuation">.</span><span class="token number">0.1</span><span class="token operator">:</span><span class="token number">6379</span><span class="token operator">></span> RPUSH list <span class="token string">"hello3"</span><span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">3</span><span class="token number">127.0</span><span class="token punctuation">.</span><span class="token number">0.1</span><span class="token operator">:</span><span class="token number">6379</span><span class="token operator">></span> RPOPLPUSH list otherlist<span class="token string">"hello3"</span><span class="token number">127.0</span><span class="token punctuation">.</span><span class="token number">0.1</span><span class="token operator">:</span><span class="token number">6379</span><span class="token operator">></span> LRANGE list <span class="token number">0</span> <span class="token operator">-</span><span class="token number">1</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">"hello1"</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">"hello2"</span><span class="token number">127.0</span><span class="token punctuation">.</span><span class="token number">0.1</span><span class="token operator">:</span><span class="token number">6379</span><span class="token operator">></span> LRANGE otherlist <span class="token number">0</span> <span class="token operator">-</span><span class="token number">1</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">"hello3"</span>####################################################LSET key index value 将列表中指定下标的值替换<span class="token number">127.0</span><span class="token punctuation">.</span><span class="token number">0.1</span><span class="token operator">:</span><span class="token number">6379</span><span class="token operator">></span> LRANGE list <span class="token number">0</span> <span class="token operator">-</span><span class="token number">1</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">"hello1"</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">"hello2"</span><span class="token number">127.0</span><span class="token punctuation">.</span><span class="token number">0.1</span><span class="token operator">:</span><span class="token number">6379</span><span class="token operator">></span> LSET list <span class="token number">0</span> <span class="token string">"aa"</span>OK<span class="token number">127.0</span><span class="token punctuation">.</span><span class="token number">0.1</span><span class="token operator">:</span><span class="token number">6379</span><span class="token operator">></span> LRANGE list <span class="token number">0</span> <span class="token operator">-</span><span class="token number">1</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">"aa"</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">"hello2"</span>####################################################LINSERT key before<span class="token operator">|</span>after pivot value  #指定字符前后插入值<span class="token number">127.0</span><span class="token punctuation">.</span><span class="token number">0.1</span><span class="token operator">:</span><span class="token number">6379</span><span class="token operator">></span> lrange list <span class="token number">0</span> <span class="token operator">-</span><span class="token number">1</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">"hello"</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">"word"</span><span class="token number">127.0</span><span class="token punctuation">.</span><span class="token number">0.1</span><span class="token operator">:</span><span class="token number">6379</span><span class="token operator">></span> LINSERT list before word <span class="token function">find</span><span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">3</span><span class="token number">127.0</span><span class="token punctuation">.</span><span class="token number">0.1</span><span class="token operator">:</span><span class="token number">6379</span><span class="token operator">></span> LRANGE list <span class="token number">0</span> <span class="token operator">-</span><span class="token number">1</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">"hello"</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">"find"</span><span class="token number">3</span><span class="token punctuation">)</span> <span class="token string">"word"</span><span class="token number">127.0</span><span class="token punctuation">.</span><span class="token number">0.1</span><span class="token operator">:</span><span class="token number">6379</span><span class="token operator">></span> LINSERT list after word <span class="token function">yeah</span><span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">4</span><span class="token number">127.0</span><span class="token punctuation">.</span><span class="token number">0.1</span><span class="token operator">:</span><span class="token number">6379</span><span class="token operator">></span> LRANGE list <span class="token number">0</span> <span class="token operator">-</span><span class="token number">1</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">"hello"</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">"find"</span><span class="token number">3</span><span class="token punctuation">)</span> <span class="token string">"word"</span><span class="token number">4</span><span class="token punctuation">)</span> <span class="token string">"yeah"</span></code></pre><p>小结：list为双向链表，在两边插入或改动值，效率最高！中间元素，相对来说效率会低一点</p><h2 id="3-3-set"><a href="#3-3-set" class="headerlink" title="3.3 set"></a>3.3 set</h2><pre class=" language-java"><code class="language-java">SADD key <span class="token punctuation">[</span>member<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">]</span>  像set中插入值SMEMBERS key 查看key中有哪些值SISMENBER key value  查看key中是否存在这个值<span class="token number">127.0</span><span class="token punctuation">.</span><span class="token number">0.1</span><span class="token operator">:</span><span class="token number">6379</span><span class="token operator">></span> SADD myset hello fine <span class="token function">word</span><span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">3</span><span class="token number">127.0</span><span class="token punctuation">.</span><span class="token number">0.1</span><span class="token operator">:</span><span class="token number">6379</span><span class="token operator">></span> SMEMBERS myset<span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">"fine"</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">"word"</span><span class="token number">3</span><span class="token punctuation">)</span> <span class="token string">"hello"</span><span class="token number">127.0</span><span class="token punctuation">.</span><span class="token number">0.1</span><span class="token operator">:</span><span class="token number">6379</span><span class="token operator">></span> SISMEMBER myset <span class="token function">hello</span><span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span><span class="token number">127.0</span><span class="token punctuation">.</span><span class="token number">0.1</span><span class="token operator">:</span><span class="token number">6379</span><span class="token operator">></span> SISMEMBER myset <span class="token function">yang</span><span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">0</span>#################################################SCARD key 查看set中值的数量SREM key value 移除key中某一个值<span class="token number">127.0</span><span class="token punctuation">.</span><span class="token number">0.1</span><span class="token operator">:</span><span class="token number">6379</span><span class="token operator">></span> SCARD <span class="token function">myset</span><span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">3</span><span class="token number">127.0</span><span class="token punctuation">.</span><span class="token number">0.1</span><span class="token operator">:</span><span class="token number">6379</span><span class="token operator">></span> SREM myset <span class="token function">word</span><span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span>#################################################SMOVE key otherkey member  移除指定元素至另一个key中<span class="token number">127.0</span><span class="token punctuation">.</span><span class="token number">0.1</span><span class="token operator">:</span><span class="token number">6379</span><span class="token operator">></span> SMOVE myset myotnerset <span class="token function">hello</span><span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span>#################################################SDIFF key1 key2 差集SINTER key1 key2 交集SUNION key1 key2 并集<span class="token number">127.0</span><span class="token punctuation">.</span><span class="token number">0.1</span><span class="token operator">:</span><span class="token number">6379</span><span class="token operator">></span> SADD key1 <span class="token function">a</span><span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span><span class="token number">127.0</span><span class="token punctuation">.</span><span class="token number">0.1</span><span class="token operator">:</span><span class="token number">6379</span><span class="token operator">></span> SADD key1 <span class="token function">b</span><span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span><span class="token number">127.0</span><span class="token punctuation">.</span><span class="token number">0.1</span><span class="token operator">:</span><span class="token number">6379</span><span class="token operator">></span> SADD key1 <span class="token function">c</span><span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span><span class="token number">127.0</span><span class="token punctuation">.</span><span class="token number">0.1</span><span class="token operator">:</span><span class="token number">6379</span><span class="token operator">></span> SADD key2 <span class="token function">c</span><span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span><span class="token number">127.0</span><span class="token punctuation">.</span><span class="token number">0.1</span><span class="token operator">:</span><span class="token number">6379</span><span class="token operator">></span> SADD key2 <span class="token function">d</span><span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span><span class="token number">127.0</span><span class="token punctuation">.</span><span class="token number">0.1</span><span class="token operator">:</span><span class="token number">6379</span><span class="token operator">></span> SADD key2 <span class="token function">e</span><span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span><span class="token number">127.0</span><span class="token punctuation">.</span><span class="token number">0.1</span><span class="token operator">:</span><span class="token number">6379</span><span class="token operator">></span> SDIFF key1 key2<span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">"a"</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">"b"</span><span class="token number">127.0</span><span class="token punctuation">.</span><span class="token number">0.1</span><span class="token operator">:</span><span class="token number">6379</span><span class="token operator">></span> SINTER key1 key2<span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">"c"</span><span class="token number">127.0</span><span class="token punctuation">.</span><span class="token number">0.1</span><span class="token operator">:</span><span class="token number">6379</span><span class="token operator">></span> SUNION key1 key2<span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">"a"</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">"b"</span><span class="token number">3</span><span class="token punctuation">)</span> <span class="token string">"c"</span><span class="token number">4</span><span class="token punctuation">)</span> <span class="token string">"d"</span><span class="token number">5</span><span class="token punctuation">)</span> <span class="token string">"e"</span></code></pre><h2 id="3-4-Hsah"><a href="#3-4-Hsah" class="headerlink" title="3.4 Hsah"></a>3.4 Hsah</h2><pre class=" language-java"><code class="language-java">HSET key filed value #hash存值HGET key filed #hash取值HMSET key <span class="token punctuation">[</span>filed value <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">]</span> #批量存HGET key <span class="token punctuation">[</span>filed<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">]</span> #批量取HGETALL key #取全部HDEL key <span class="token punctuation">[</span>filed<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">]</span> #删除某一个或某几个HLEN key #获取长度HEXISTS key value #获取某个值是否存在HKEYS key #获取所有的filedHVALS key #获取所有的value<span class="token number">127.0</span><span class="token punctuation">.</span><span class="token number">0.1</span><span class="token operator">:</span><span class="token number">6379</span><span class="token operator">></span> HSET myhash name <span class="token function">yang</span> <span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span><span class="token number">127.0</span><span class="token punctuation">.</span><span class="token number">0.1</span><span class="token operator">:</span><span class="token number">6379</span><span class="token operator">></span> HGET myhash name<span class="token string">"yang"</span><span class="token number">127.0</span><span class="token punctuation">.</span><span class="token number">0.1</span><span class="token operator">:</span><span class="token number">6379</span><span class="token operator">></span> HMSET myhash name yang1 age <span class="token number">18</span>OK<span class="token number">127.0</span><span class="token punctuation">.</span><span class="token number">0.1</span><span class="token operator">:</span><span class="token number">6379</span><span class="token operator">></span> HMGET myhash name age<span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">"yang1"</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">"18"</span><span class="token number">127.0</span><span class="token punctuation">.</span><span class="token number">0.1</span><span class="token operator">:</span><span class="token number">6379</span><span class="token operator">></span> HGETALL myhash<span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">"name"</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">"yang1"</span><span class="token number">3</span><span class="token punctuation">)</span> <span class="token string">"age"</span><span class="token number">4</span><span class="token punctuation">)</span> <span class="token string">"18"</span><span class="token number">127.0</span><span class="token punctuation">.</span><span class="token number">0.1</span><span class="token operator">:</span><span class="token number">6379</span><span class="token operator">></span> HDEL myhash <span class="token function">name</span><span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span><span class="token number">127.0</span><span class="token punctuation">.</span><span class="token number">0.1</span><span class="token operator">:</span><span class="token number">6379</span><span class="token operator">></span> HLEN <span class="token function">myhash</span><span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span><span class="token number">127.0</span><span class="token punctuation">.</span><span class="token number">0.1</span><span class="token operator">:</span><span class="token number">6379</span><span class="token operator">></span> HEXISTS myhash <span class="token function">age</span><span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span></code></pre><h2 id="3-5-zset（有序集合）"><a href="#3-5-zset（有序集合）" class="headerlink" title="3.5 zset（有序集合）"></a>3.5 zset（有序集合）</h2><pre class=" language-java"><code class="language-java"><span class="token number">127.0</span><span class="token punctuation">.</span><span class="token number">0.1</span><span class="token operator">:</span><span class="token number">6379</span><span class="token operator">></span> ZADD myset <span class="token number">100</span> <span class="token function">xiaoming</span><span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span><span class="token number">127.0</span><span class="token punctuation">.</span><span class="token number">0.1</span><span class="token operator">:</span><span class="token number">6379</span><span class="token operator">></span> ZADD myset <span class="token number">200</span> <span class="token function">xiaohong</span><span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span><span class="token number">127.0</span><span class="token punctuation">.</span><span class="token number">0.1</span><span class="token operator">:</span><span class="token number">6379</span><span class="token operator">></span> ZADD myset <span class="token number">300</span> <span class="token function">xiaowang</span><span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span><span class="token number">127.0</span><span class="token punctuation">.</span><span class="token number">0.1</span><span class="token operator">:</span><span class="token number">6379</span><span class="token operator">></span> ZRANGEBYSCORE myset <span class="token operator">-</span>inf <span class="token operator">+</span>inf  #显示全部的用户，从小到大<span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">"xiaoming"</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">"xiaohong"</span><span class="token number">3</span><span class="token punctuation">)</span> <span class="token string">"xiaowang"</span><span class="token number">127.0</span><span class="token punctuation">.</span><span class="token number">0.1</span><span class="token operator">:</span><span class="token number">6379</span><span class="token operator">></span> ZRANGEBYSCORE myset <span class="token operator">-</span>inf <span class="token operator">+</span>inf withscores #显示全部的用户，从小到大并附带值<span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">"xiaoming"</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">"100"</span><span class="token number">3</span><span class="token punctuation">)</span> <span class="token string">"xiaohong"</span><span class="token number">4</span><span class="token punctuation">)</span> <span class="token string">"200"</span><span class="token number">5</span><span class="token punctuation">)</span> <span class="token string">"xiaowang"</span><span class="token number">6</span><span class="token punctuation">)</span> <span class="token string">"300"</span><span class="token number">127.0</span><span class="token punctuation">.</span><span class="token number">0.1</span><span class="token operator">:</span><span class="token number">6379</span><span class="token operator">></span> ZREVRANGE myset <span class="token number">0</span> <span class="token operator">-</span><span class="token number">1</span>  #显示全部的用户，从大到小<span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">"xiaowang"</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">"xiaohong"</span><span class="token number">3</span><span class="token punctuation">)</span> <span class="token string">"xiaoming"</span><span class="token number">127.0</span><span class="token punctuation">.</span><span class="token number">0.1</span><span class="token operator">:</span><span class="token number">6379</span><span class="token operator">></span> ZREVRANGE myset <span class="token number">0</span> <span class="token operator">-</span><span class="token number">1</span> withscores<span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">"xiaowang"</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">"300"</span><span class="token number">3</span><span class="token punctuation">)</span> <span class="token string">"xiaohong"</span><span class="token number">4</span><span class="token punctuation">)</span> <span class="token string">"200"</span><span class="token number">5</span><span class="token punctuation">)</span> <span class="token string">"xiaoming"</span><span class="token number">6</span><span class="token punctuation">)</span> <span class="token string">"100"</span><span class="token number">127.0</span><span class="token punctuation">.</span><span class="token number">0.1</span><span class="token operator">:</span><span class="token number">6379</span><span class="token operator">></span> ZRANGEBYSCORE myset <span class="token operator">-</span>inf <span class="token number">200</span> withscores #显示小于等于<span class="token number">200</span>全部的用户，从小到大并附带值<span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">"xiaoming"</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">"100"</span><span class="token number">3</span><span class="token punctuation">)</span> <span class="token string">"xiaohong"</span><span class="token number">4</span><span class="token punctuation">)</span> <span class="token string">"200"</span></code></pre><h1 id="4-三种特殊数据类型"><a href="#4-三种特殊数据类型" class="headerlink" title="4.三种特殊数据类型"></a>4.三种特殊数据类型</h1><h2 id="4-1geospatial-地理位置"><a href="#4-1geospatial-地理位置" class="headerlink" title="4.1geospatial 地理位置"></a>4.1geospatial 地理位置</h2><p>GEOADD</p><pre class=" language-java"><code class="language-java">#getadd 添加地理位置#规则：两级无法直接添加#有效的经度从<span class="token operator">-</span><span class="token number">180</span>度到<span class="token number">180</span>度#有效的纬度从<span class="token operator">-</span><span class="token number">85.05112878</span>度到<span class="token number">85.05112878</span>GEOADD china<span class="token operator">:</span>city <span class="token number">116.40</span> <span class="token number">39.90</span> beijing <span class="token number">121.47</span> <span class="token number">31.23</span> shanghai</code></pre><p>GEOPOS</p><pre class=" language-java"><code class="language-java"><span class="token number">127.0</span><span class="token punctuation">.</span><span class="token number">0.1</span><span class="token operator">:</span><span class="token number">6379</span><span class="token operator">></span> GEOPOS china<span class="token operator">:</span>city beijing #获取城市的经度和纬度<span class="token number">1</span><span class="token punctuation">)</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">"116.39999896287918091"</span>   <span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">"39.90000009167092543"</span></code></pre><p>GEODIST key member1 member2 [unit]</p><blockquote><p>返回两个给定位置之间的距离。<br>如果两个位置之间的其中一个不存在， 那么命令返回空值。<br>指定单位的参数 unit 必须是以下单位的其中一个：<br>m 表示单位为米。<br>km 表示单位为千米。<br>mi 表示单位为英里。<br>ft 表示单位为英尺。<br>如果用户没有显式地指定单位参数， 那么 GEODIST 默认使用米作为单位。<br>GEODIST 命令在计算距离时会假设地球为完美的球形， 在极限情况下， 这一假设最大会造成 0.5% 的误差。</p></blockquote><pre class=" language-java"><code class="language-java"><span class="token number">127.0</span><span class="token punctuation">.</span><span class="token number">0.1</span><span class="token operator">:</span><span class="token number">6379</span><span class="token operator">></span> GEODIST china<span class="token operator">:</span>city beijing shanghai km<span class="token string">"1067.3788"</span></code></pre><p>GEORADIUSjava</p><blockquote><p>key longitude latitude radius m|km|ft|mi [WITHCOORD] [WITHDIST] [WITHHASH] [COUNT count]<br>以给定的经纬度为中心， 返回键包含的位置元素当中， 与中心的距离不超过给定最大距离的所有位置元素。<br>范围可以使用以下其中一个单位：<br>m 表示单位为米。<br>km 表示单位为千米。<br>mi 表示单位为英里。<br>ft 表示单位为英尺。<br>在给定以下可选项时， 命令会返回额外的信息：<br>WITHDIST: 在返回位置元素的同时， 将位置元素与中心之间的距离也一并返回。 距离的单位和用户给定的范围单位保持一致。<br>WITHCOORD: 将位置元素的经度和维度也一并返回。<br>WITHHASH: 以 52 位有符号整数的形式， 返回位置元素经过原始 geohash 编码的有序集合分值。 这个选项主要用于底层应用或者调试， 实际中的作用并不大。<br>命令默认返回未排序的位置元素。 通过以下两个参数， 用户可以指定被返回位置元素的排序方式：<br>ASC: 根据中心的位置， 按照从近到远的方式返回位置元素。<br>DESC: 根据中心的位置， 按照从远到近的方式返回位置元素。<br>在默认情况下， GEORADIUS 命令会返回所有匹配的位置元素。 虽然用户可以使用 COUNT 选项去获取前 N 个匹配元素， 但是因为命令在内部可能会需要对所有被匹配的元素进行处理， 所以在对一个非常大的区域进行搜索时， 即使只使用 COUNT 选项去获取少量元素， 命令的执行速度也可能会非常慢。 但是从另一方面来说， 使用 COUNT 选项去减少需要返回的元素数量， 对于减少带宽来说仍然是非常有用的。</p></blockquote><pre class=" language-java"><code class="language-java"><span class="token number">127.0</span><span class="token punctuation">.</span><span class="token number">0.1</span><span class="token operator">:</span><span class="token number">6379</span><span class="token operator">></span> GEORADIUS china<span class="token operator">:</span>city <span class="token number">110</span> <span class="token number">30</span> <span class="token number">5000</span> km  #以经纬度为<span class="token number">110</span> <span class="token number">30</span>为中心查询5000km的城市<span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">"shanghai"</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">"beijing"</span><span class="token number">127.0</span><span class="token punctuation">.</span><span class="token number">0.1</span><span class="token operator">:</span><span class="token number">6379</span><span class="token operator">></span> GEORADIUS china<span class="token operator">:</span>city <span class="token number">110</span> <span class="token number">30</span> <span class="token number">5000</span> km withdist #显示到中间距离的位置<span class="token number">1</span><span class="token punctuation">)</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">"shanghai"</span>   <span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">"1105.9098"</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">"beijing"</span>   <span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">"1245.2858"</span></code></pre><p>GEORADIUSBYMEMBER</p><blockquote><p>key member radius m|km|ft|mi [WITHCOORD] [WITHDIST] [WITHHASH] [COUNT count]<br>这个命令和 GEORADIUS 命令一样， 都可以找出位于指定范围内的元素， 但是 GEORADIUSBYMEMBER 的中心点是由给定的位置元素决定的， 而不是像 GEORADIUS 那样， 使用输入的经度和纬度来决定中心点<br>指定成员的位置被用作查询的中心。</p></blockquote><p>GEOHASH key member [member …]</p><blockquote><p>该命令将返回11个字符的Geohash字符串，所以没有精度Geohash，损失相比，使用内部52位表示。返回的geohashes具有以下特性<br>他们可以缩短从右边的字符。它将失去精度，但仍将指向同一地区。<br>它可以在 geohash.org 网站使用，网址 <a href="http://geohash.org/%E3%80%82%E6%9F%A5%E8%AF%A2%E4%BE%8B%E5%AD%90%EF%BC%9Ahttp://geohash.org/sqdtr74hyu0">http://geohash.org/。查询例子：http://geohash.org/sqdtr74hyu0</a>.<br>与类似的前缀字符串是附近，但相反的是不正确的，这是可能的，用不同的前缀字符串附近。</p></blockquote><blockquote><p>GEO底层的实现原理其实就是Zset！我们可以使用Zset命令操作geo</p></blockquote><pre class=" language-java"><code class="language-java"><span class="token number">127.0</span><span class="token punctuation">.</span><span class="token number">0.1</span><span class="token operator">:</span><span class="token number">6379</span><span class="token operator">></span> ZRANGE china<span class="token operator">:</span>city <span class="token number">0</span> <span class="token operator">-</span><span class="token number">1</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">"shanghai"</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">"beijing"</span></code></pre><h2 id="4-2、Hyperloglog"><a href="#4-2、Hyperloglog" class="headerlink" title="4.2、Hyperloglog"></a>4.2、Hyperloglog</h2><blockquote><p>简介<br>Redis2.8.9版本更新了Hyperloglog数据结构<br>Redis Hyperloglog基数统计的算法<br>优点：占用的内存是固定，2^6不同的元素的计数，只需要废12kb内存，如果从内存角度来比较的话Hyperloglog首选<br>网页的UV（一个人访问一个网站多次，但是还是算作一个人）<br>传统的方式，set保存用户的id，然后就可以统计set中的元素数量作为标准判断<br>这个方式如果保存大量的用户id，就会比较麻烦！我们目的是为了计数，而不是保存用户id<br>0.81%错误率！统计UV任务，可以忽略不计。</p></blockquote><pre class=" language-java"><code class="language-java"><span class="token number">127.0</span><span class="token punctuation">.</span><span class="token number">0.1</span><span class="token operator">:</span><span class="token number">6379</span><span class="token operator">></span> PFADD mykey a b c d e f  #创建第一组元素 <span class="token function">mykey</span><span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span><span class="token number">127.0</span><span class="token punctuation">.</span><span class="token number">0.1</span><span class="token operator">:</span><span class="token number">6379</span><span class="token operator">></span> PFCOUNT mykey #统计mykey中元素的数量<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">6</span><span class="token number">127.0</span><span class="token punctuation">.</span><span class="token number">0.1</span><span class="token operator">:</span><span class="token number">6379</span><span class="token operator">></span> PFADD mykey1 b c d r j d #创建第二组元素 <span class="token function">mykey1</span><span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span><span class="token number">127.0</span><span class="token punctuation">.</span><span class="token number">0.1</span><span class="token operator">:</span><span class="token number">6379</span><span class="token operator">></span> PFCOUNT <span class="token function">mykey1</span><span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">5</span><span class="token number">127.0</span><span class="token punctuation">.</span><span class="token number">0.1</span><span class="token operator">:</span><span class="token number">6379</span><span class="token operator">></span> PFMERGE mykey2 mykey mykey1 #合并两组mykey mykey1 <span class="token operator">=</span><span class="token operator">></span> mykey2 并集OK<span class="token number">127.0</span><span class="token punctuation">.</span><span class="token number">0.1</span><span class="token operator">:</span><span class="token number">6379</span><span class="token operator">></span> PFCOUNT mykey2 #查看并集数量<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">8</span></code></pre><h2 id="4-3、Bitmap"><a href="#4-3、Bitmap" class="headerlink" title="4.3、Bitmap"></a>4.3、Bitmap</h2><blockquote><p>位存储统计用户信息，活跃，不活跃，打卡，未打卡 两个状态的数据，都可以使用BitmapsBitmap位图，数据结构！都是二进制位来进行记录，就只有0和1两个状态</p></blockquote><pre class=" language-java"><code class="language-java"><span class="token number">127.0</span><span class="token punctuation">.</span><span class="token number">0.1</span><span class="token operator">:</span><span class="token number">6379</span><span class="token operator">></span> setbit sign <span class="token number">0</span> <span class="token number">1</span>  #第<span class="token number">1</span>天 打卡了<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">0</span><span class="token number">127.0</span><span class="token punctuation">.</span><span class="token number">0.1</span><span class="token operator">:</span><span class="token number">6379</span><span class="token operator">></span> setbit sign <span class="token number">1</span> <span class="token number">1</span> #第<span class="token number">2</span>天 打卡了<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">0</span> <span class="token number">127.0</span><span class="token punctuation">.</span><span class="token number">0.1</span><span class="token operator">:</span><span class="token number">6379</span><span class="token operator">></span> setbit sign <span class="token number">2</span> <span class="token number">0</span> #第<span class="token number">3</span>天 没打卡<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">0</span><span class="token number">127.0</span><span class="token punctuation">.</span><span class="token number">0.1</span><span class="token operator">:</span><span class="token number">6379</span><span class="token operator">></span> setbit sign <span class="token number">3</span> <span class="token function">0</span><span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">0</span><span class="token number">127.0</span><span class="token punctuation">.</span><span class="token number">0.1</span><span class="token operator">:</span><span class="token number">6379</span><span class="token operator">></span> setbit sign <span class="token number">4</span> <span class="token function">1</span><span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">0</span><span class="token number">127.0</span><span class="token punctuation">.</span><span class="token number">0.1</span><span class="token operator">:</span><span class="token number">6379</span><span class="token operator">></span> getbit sign <span class="token number">0</span>  #获取某一天是否打卡<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span><span class="token number">127.0</span><span class="token punctuation">.</span><span class="token number">0.1</span><span class="token operator">:</span><span class="token number">6379</span><span class="token operator">></span> BITCOUNT sign <span class="token number">0</span> <span class="token number">4</span>  #第一天到第五天共计打卡几次<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">3</span></code></pre><h1 id="5-事务"><a href="#5-事务" class="headerlink" title="5.事务"></a>5.事务</h1><p>Redis事务本质：一组命令的集合！一个事务中的所有命令都会被序列化，在事务执行过程中，会按照顺序执行！一次性、顺序性、排他性！执行一系列的命令<br><code>-----------------队列 set set set 执行 </code></p><p>Redis事务没有隔离级别的概念！<br>所有的命令在事务中，并没有被直接执行！只有发起执行命令的时候才会执行！Exec<br>Redis单条命令是保持原子性的，但是事务不保证原子性！</p><p>Redis的事务：</p><ul><li>开启事务（multi）</li><li>命令入队（…）</li><li>执行事务（）</li></ul><blockquote><p>正常执行事务</p></blockquote><pre class=" language-java"><code class="language-java"><span class="token number">127.0</span><span class="token punctuation">.</span><span class="token number">0.1</span><span class="token operator">:</span><span class="token number">6379</span><span class="token operator">></span> MULTI  #开启事务OK<span class="token number">127.0</span><span class="token punctuation">.</span><span class="token number">0.1</span><span class="token operator">:</span><span class="token number">6379</span><span class="token operator">></span> set k1 v1  #命令入队QUEUED<span class="token number">127.0</span><span class="token punctuation">.</span><span class="token number">0.1</span><span class="token operator">:</span><span class="token number">6379</span><span class="token operator">></span> set k2 v2QUEUED<span class="token number">127.0</span><span class="token punctuation">.</span><span class="token number">0.1</span><span class="token operator">:</span><span class="token number">6379</span><span class="token operator">></span> set k3 v3QUEUED<span class="token number">127.0</span><span class="token punctuation">.</span><span class="token number">0.1</span><span class="token operator">:</span><span class="token number">6379</span><span class="token operator">></span> EXEC #执行事务<span class="token number">1</span><span class="token punctuation">)</span> OK<span class="token number">2</span><span class="token punctuation">)</span> OK<span class="token number">3</span><span class="token punctuation">)</span> OK<span class="token number">127.0</span><span class="token punctuation">.</span><span class="token number">0.1</span><span class="token operator">:</span><span class="token number">6379</span><span class="token operator">></span></code></pre><blockquote><p>放弃事务</p></blockquote><pre class=" language-java"><code class="language-java"><span class="token number">127.0</span><span class="token punctuation">.</span><span class="token number">0.1</span><span class="token operator">:</span><span class="token number">6379</span><span class="token operator">></span> MULTIOK<span class="token number">127.0</span><span class="token punctuation">.</span><span class="token number">0.1</span><span class="token operator">:</span><span class="token number">6379</span><span class="token operator">></span> set k1 v1QUEUED<span class="token number">127.0</span><span class="token punctuation">.</span><span class="token number">0.1</span><span class="token operator">:</span><span class="token number">6379</span><span class="token operator">></span> set k4 v4QUEUED<span class="token number">127.0</span><span class="token punctuation">.</span><span class="token number">0.1</span><span class="token operator">:</span><span class="token number">6379</span><span class="token operator">></span> DISCARD  #放弃事务OK</code></pre><blockquote><p>编译型异常（代码有问题！命令有错），事务中所有的命令都不会被执行</p></blockquote><pre class=" language-java"><code class="language-java"><span class="token number">127.0</span><span class="token punctuation">.</span><span class="token number">0.1</span><span class="token operator">:</span><span class="token number">6379</span><span class="token operator">></span> MULTIOK<span class="token number">127.0</span><span class="token punctuation">.</span><span class="token number">0.1</span><span class="token operator">:</span><span class="token number">6379</span><span class="token operator">></span> set k1 v1QUEUED<span class="token number">127.0</span><span class="token punctuation">.</span><span class="token number">0.1</span><span class="token operator">:</span><span class="token number">6379</span><span class="token operator">></span> set k2 v2QUEUED<span class="token number">127.0</span><span class="token punctuation">.</span><span class="token number">0.1</span><span class="token operator">:</span><span class="token number">6379</span><span class="token operator">></span> getset k3  #错误的命令<span class="token punctuation">(</span>error<span class="token punctuation">)</span> ERR wrong number of arguments <span class="token keyword">for</span> <span class="token string">'getset'</span> command<span class="token number">127.0</span><span class="token punctuation">.</span><span class="token number">0.1</span><span class="token operator">:</span><span class="token number">6379</span><span class="token operator">></span> set k4 v4QUEUED<span class="token number">127.0</span><span class="token punctuation">.</span><span class="token number">0.1</span><span class="token operator">:</span><span class="token number">6379</span><span class="token operator">></span> <span class="token function">EXEC</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span> EXECABORT Transaction discarded because of previous errors<span class="token punctuation">.</span><span class="token number">127.0</span><span class="token punctuation">.</span><span class="token number">0.1</span><span class="token operator">:</span><span class="token number">6379</span><span class="token operator">></span> get k1  #所有的命令都不会被执行<span class="token punctuation">(</span>nil<span class="token punctuation">)</span></code></pre><blockquote><p>运行时异常（1/0），如果事务队列中存在语法性，那么执行命令的时候，其他命令是可以正常执行的，错误命令抛出异常</p></blockquote><pre class=" language-java"><code class="language-java"><span class="token number">127.0</span><span class="token punctuation">.</span><span class="token number">0.1</span><span class="token operator">:</span><span class="token number">6379</span><span class="token operator">></span> set k1 v1OK<span class="token number">127.0</span><span class="token punctuation">.</span><span class="token number">0.1</span><span class="token operator">:</span><span class="token number">6379</span><span class="token operator">></span> MULTIOK<span class="token number">127.0</span><span class="token punctuation">.</span><span class="token number">0.1</span><span class="token operator">:</span><span class="token number">6379</span><span class="token operator">></span> INCR k1 #会执行失败QUEUED<span class="token number">127.0</span><span class="token punctuation">.</span><span class="token number">0.1</span><span class="token operator">:</span><span class="token number">6379</span><span class="token operator">></span> set k2 v2QUEUED<span class="token number">127.0</span><span class="token punctuation">.</span><span class="token number">0.1</span><span class="token operator">:</span><span class="token number">6379</span><span class="token operator">></span> exec<span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> ERR value is not an integer or out of range  #后续的命令可以正常执行<span class="token number">2</span><span class="token punctuation">)</span> OK</code></pre><blockquote><p>监控 Watch</p></blockquote><p>悲观锁很悲观，</p><ul><li>什么时候都会出问题，无论做什么都会加锁</li></ul><p>乐观锁</p><ul><li>很乐观，认为什么时候都不会出问题，所以不会上锁！更新数据的时候判断一下，在此期间是否有人修改过这个数据</li><li>获取version</li><li>更新的时候比较version</li></ul><blockquote><p>Redis监视测试</p></blockquote><p>正常执行成功</p><pre class=" language-java"><code class="language-java"><span class="token number">127.0</span><span class="token punctuation">.</span><span class="token number">0.1</span><span class="token operator">:</span><span class="token number">6379</span><span class="token operator">></span> set k1 v1OK<span class="token number">127.0</span><span class="token punctuation">.</span><span class="token number">0.1</span><span class="token operator">:</span><span class="token number">6379</span><span class="token operator">></span> MULTIOK<span class="token number">127.0</span><span class="token punctuation">.</span><span class="token number">0.1</span><span class="token operator">:</span><span class="token number">6379</span><span class="token operator">></span> INCR k1QUEUED<span class="token number">127.0</span><span class="token punctuation">.</span><span class="token number">0.1</span><span class="token operator">:</span><span class="token number">6379</span><span class="token operator">></span> set k2 v2QUEUED<span class="token number">127.0</span><span class="token punctuation">.</span><span class="token number">0.1</span><span class="token operator">:</span><span class="token number">6379</span><span class="token operator">></span> exec<span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> ERR value is not an integer or out of range<span class="token number">2</span><span class="token punctuation">)</span> OK</code></pre><p>测试多线程修改值，使用watch可以当作redis的乐观锁操作<br><img src="https://edu-2539.oss-cn-beijing.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E5%9B%BE%E7%89%87/20210327152307821.png" alt="image"><br><img src="https://edu-2539.oss-cn-beijing.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E5%9B%BE%E7%89%87/20210327152413256.png" alt="image"><br>解除监控，unwatch<br><img src="https://edu-2539.oss-cn-beijing.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E5%9B%BE%E7%89%87/20210327152933111.png" alt="image"></p><h1 id="6、jedis"><a href="#6、jedis" class="headerlink" title="6、jedis"></a>6、jedis</h1><blockquote><p>什么是jedis</p></blockquote><p>jedis是Redis官方推荐的java连接开发工具！使用java操作redis中间件！</p><blockquote><p>测试</p></blockquote><p>1.导入对应的依赖</p><pre class=" language-java"><code class="language-java"><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span>导入jedis包<span class="token operator">--</span><span class="token operator">></span>        <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> https<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>mvnrepository<span class="token punctuation">.</span>com<span class="token operator">/</span>artifact<span class="token operator">/</span>redis<span class="token punctuation">.</span>clients<span class="token operator">/</span>jedis <span class="token operator">--</span><span class="token operator">></span>        <span class="token operator">&lt;</span>dependency<span class="token operator">></span>            <span class="token operator">&lt;</span>groupId<span class="token operator">></span>redis<span class="token punctuation">.</span>clients<span class="token operator">&lt;</span><span class="token operator">/</span>groupId<span class="token operator">></span>            <span class="token operator">&lt;</span>artifactId<span class="token operator">></span>jedis<span class="token operator">&lt;</span><span class="token operator">/</span>artifactId<span class="token operator">></span>            <span class="token operator">&lt;</span>version<span class="token operator">></span><span class="token number">3.2</span><span class="token punctuation">.</span><span class="token number">0</span><span class="token operator">&lt;</span><span class="token operator">/</span>version<span class="token operator">></span>        <span class="token operator">&lt;</span><span class="token operator">/</span>dependency<span class="token operator">></span>        <span class="token operator">&lt;</span>dependency<span class="token operator">></span>            <span class="token operator">&lt;</span>groupId<span class="token operator">></span>com<span class="token punctuation">.</span>alibaba<span class="token operator">&lt;</span><span class="token operator">/</span>groupId<span class="token operator">></span>            <span class="token operator">&lt;</span>artifactId<span class="token operator">></span>fastjson<span class="token operator">&lt;</span><span class="token operator">/</span>artifactId<span class="token operator">></span>            <span class="token operator">&lt;</span>version<span class="token operator">></span><span class="token number">1.2</span><span class="token punctuation">.</span><span class="token number">62</span><span class="token operator">&lt;</span><span class="token operator">/</span>version<span class="token operator">></span>        <span class="token operator">&lt;</span><span class="token operator">/</span>dependency<span class="token operator">></span></code></pre><p>2.编码测试</p><blockquote><p>如果需要连接远程redis服务，不连接本地redis服务<br>一：修改配置文件 redis.conf<br>1.注掉bing 127.0.0.1<br>2.设置访问redis的密码 requirepass 密码<br>3.重启redis服务<br>4.使用密码登录 redis-cli redis配置文件 -h 127.0.0.1 -p 6379 -a 密码<br>二：关掉防火墙：systemctl stop firewalld<br>#注意防火墙每次重启服务器都会自动开放，为了安全不建议移除自启动，移除防火墙自启动systemctl disable firewalld<br>或者可以开放防火墙端口：<br>firewall-cmd –permanent –add-port=6379/tcp<br>firewall-cmd –reload<br>三：idea连接时增加<br>jedis.auth(“123”);//123为配置文件中设置的密码</p></blockquote><pre class=" language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TestPing</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>        Jedis jedis <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Jedis</span><span class="token punctuation">(</span><span class="token string">"192.168.1.101"</span><span class="token punctuation">,</span> <span class="token number">6379</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        jedis<span class="token punctuation">.</span><span class="token function">auth</span><span class="token punctuation">(</span><span class="token string">"123"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>jedis<span class="token punctuation">.</span><span class="token function">ping</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><h1 id="7、SpringBoot整合"><a href="#7、SpringBoot整合" class="headerlink" title="7、SpringBoot整合"></a>7、SpringBoot整合</h1><p>SpringBoot操作数据：spring-data jpa jdbc mongodb redis!SpringData 也是和SpringBoot齐名的项目说明：在SpringBoot2.x之后，原来使用的jedis被替换为了lettuce</p><blockquote><p>为什么将jedis替换为lettuce？<br>jedis：采用的直连，多个线程操作的话，是不安全的，如果想要避免不安全的，使用jedis pool连接池！更像BIO模式<br>lettuce：采用netty，实例可以在多个线程中进行共享，不存在线程不安全的情况！可以减少线程数据了，更像NIO模式</p></blockquote><p>源码分析：</p><pre class=" language-java"><code class="language-java"><span class="token annotation punctuation">@Configuration</span><span class="token punctuation">(</span>proxyBeanMethods <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token annotation punctuation">@ConditionalOnClass</span><span class="token punctuation">(</span>RedisOperations<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token annotation punctuation">@EnableConfigurationProperties</span><span class="token punctuation">(</span>RedisProperties<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token annotation punctuation">@Import</span><span class="token punctuation">(</span><span class="token punctuation">{</span> LettuceConnectionConfiguration<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> JedisConnectionConfiguration<span class="token punctuation">.</span><span class="token keyword">class</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RedisAutoConfiguration</span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@Bean</span>    <span class="token annotation punctuation">@ConditionalOnMissingBean</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">"redisTemplate"</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">//我们可以自己定义一个</span>    <span class="token annotation punctuation">@ConditionalOnSingleCandidate</span><span class="token punctuation">(</span>RedisConnectionFactory<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>    <span class="token keyword">public</span> RedisTemplate<span class="token operator">&lt;</span>Object<span class="token punctuation">,</span> Object<span class="token operator">></span> <span class="token function">redisTemplate</span><span class="token punctuation">(</span>RedisConnectionFactory redisConnectionFactory<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">//默认的RedisTemplate没有过多的设置，redis对象都是需要序列化的</span>        <span class="token comment" spellcheck="true">//两个泛型都是Object，Object的类型，我们使用后需要强制转换&lt;String,Object></span>        RedisTemplate<span class="token operator">&lt;</span>Object<span class="token punctuation">,</span> Object<span class="token operator">></span> template <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RedisTemplate</span><span class="token operator">&lt;</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        template<span class="token punctuation">.</span><span class="token function">setConnectionFactory</span><span class="token punctuation">(</span>redisConnectionFactory<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> template<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token annotation punctuation">@Bean</span>    <span class="token annotation punctuation">@ConditionalOnMissingBean</span>    <span class="token annotation punctuation">@ConditionalOnSingleCandidate</span><span class="token punctuation">(</span>RedisConnectionFactory<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>    <span class="token keyword">public</span> StringRedisTemplate <span class="token function">stringRedisTemplate</span><span class="token punctuation">(</span>RedisConnectionFactory redisConnectionFactory<span class="token punctuation">)</span> <span class="token punctuation">{</span>        StringRedisTemplate template <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StringRedisTemplate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        template<span class="token punctuation">.</span><span class="token function">setConnectionFactory</span><span class="token punctuation">(</span>redisConnectionFactory<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> template<span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>1、导入依赖</p><pre class=" language-java"><code class="language-java"><span class="token operator">&lt;</span>dependency<span class="token operator">></span>    <span class="token operator">&lt;</span>groupId<span class="token operator">></span>org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token operator">&lt;</span><span class="token operator">/</span>groupId<span class="token operator">></span>    <span class="token operator">&lt;</span>artifactId<span class="token operator">></span>spring<span class="token operator">-</span>boot<span class="token operator">-</span>starter<span class="token operator">-</span>data<span class="token operator">-</span>redis<span class="token operator">&lt;</span><span class="token operator">/</span>artifactId<span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>dependency<span class="token operator">></span></code></pre><p>2、配置连接</p><pre class=" language-java"><code class="language-java">spring<span class="token operator">:</span>  redis<span class="token operator">:</span>    host<span class="token operator">:</span> <span class="token number">192.168</span><span class="token punctuation">.</span><span class="token number">1.101</span>    port<span class="token operator">:</span> <span class="token number">6379</span>    password<span class="token operator">:</span> <span class="token number">123</span></code></pre><p>3.测试</p><pre class=" language-java"><code class="language-java"><span class="token annotation punctuation">@SpringBootTest</span><span class="token keyword">class</span> <span class="token class-name">RedisSpringStudyApplicationTests</span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@Autowired</span>    <span class="token keyword">private</span> RedisTemplate redisTemplate<span class="token punctuation">;</span>    <span class="token annotation punctuation">@Test</span>    <span class="token keyword">void</span> <span class="token function">contextLoads</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">//redisTemplate  操作不同的数据类型，api和命令是一样的</span>        <span class="token comment" spellcheck="true">//opsForValue 操作字符串 类似String</span>        <span class="token comment" spellcheck="true">//opsForList()</span>        <span class="token comment" spellcheck="true">//opsForSet()</span>        <span class="token comment" spellcheck="true">//opsForZSet()</span>        <span class="token comment" spellcheck="true">//opsForHash()</span>        <span class="token comment" spellcheck="true">//opsForGeo()</span>        <span class="token comment" spellcheck="true">//opsForHyperLogLog()</span>        <span class="token comment" spellcheck="true">//除了基本的操作，我们常用的方法都可以直接通过redisTemplate操作，比如事务，和基本的CRUD</span>        <span class="token comment" spellcheck="true">//获取连接对象</span>        <span class="token comment" spellcheck="true">//RedisConnection connection = redisTemplate.getConnectionFactory().getConnection();</span>        <span class="token comment" spellcheck="true">//connection.flushAll();</span>        <span class="token comment" spellcheck="true">//connection.flushDb();</span>        redisTemplate<span class="token punctuation">.</span><span class="token function">opsForValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">"myKey"</span><span class="token punctuation">,</span> <span class="token string">"hello redis"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>redisTemplate<span class="token punctuation">.</span><span class="token function">opsForValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"myKey"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p><em>不序列化会报异常</em></p><h2 id="7-1、自定义RedisTemplate"><a href="#7-1、自定义RedisTemplate" class="headerlink" title="7.1、自定义RedisTemplate"></a>7.1、自定义RedisTemplate</h2><pre class=" language-java"><code class="language-java"><span class="token keyword">import</span> com<span class="token punctuation">.</span>fasterxml<span class="token punctuation">.</span>jackson<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span>JsonAutoDetect<span class="token punctuation">;</span><span class="token keyword">import</span> com<span class="token punctuation">.</span>fasterxml<span class="token punctuation">.</span>jackson<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span>PropertyAccessor<span class="token punctuation">;</span><span class="token keyword">import</span> com<span class="token punctuation">.</span>fasterxml<span class="token punctuation">.</span>jackson<span class="token punctuation">.</span>databind<span class="token punctuation">.</span>ObjectMapper<span class="token punctuation">;</span><span class="token keyword">import</span> com<span class="token punctuation">.</span>fasterxml<span class="token punctuation">.</span>jackson<span class="token punctuation">.</span>databind<span class="token punctuation">.</span>jsontype<span class="token punctuation">.</span>impl<span class="token punctuation">.</span>LaissezFaireSubTypeValidator<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span>Bean<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span>Configuration<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>data<span class="token punctuation">.</span>redis<span class="token punctuation">.</span>connection<span class="token punctuation">.</span>RedisConnectionFactory<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>data<span class="token punctuation">.</span>redis<span class="token punctuation">.</span>core<span class="token punctuation">.</span>RedisTemplate<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>data<span class="token punctuation">.</span>redis<span class="token punctuation">.</span>serializer<span class="token punctuation">.</span>Jackson2JsonRedisSerializer<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>data<span class="token punctuation">.</span>redis<span class="token punctuation">.</span>serializer<span class="token punctuation">.</span>StringRedisSerializer<span class="token punctuation">;</span><span class="token annotation punctuation">@Configuration</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RedisConfig</span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@Bean</span>    <span class="token keyword">public</span> RedisTemplate<span class="token operator">&lt;</span>String<span class="token punctuation">,</span> Object<span class="token operator">></span> <span class="token function">redisTemplate</span><span class="token punctuation">(</span>RedisConnectionFactory redisConnectionFactory<span class="token punctuation">)</span> <span class="token punctuation">{</span>        RedisTemplate<span class="token operator">&lt;</span>String<span class="token punctuation">,</span> Object<span class="token operator">></span> template <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RedisTemplate</span><span class="token operator">&lt;</span>String<span class="token punctuation">,</span> Object<span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        template<span class="token punctuation">.</span><span class="token function">setConnectionFactory</span><span class="token punctuation">(</span>redisConnectionFactory<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">//Json序列化配置</span>        Jackson2JsonRedisSerializer jackson2JsonRedisSerializer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Jackson2JsonRedisSerializer</span><span class="token operator">&lt;</span><span class="token operator">></span><span class="token punctuation">(</span>Object<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        ObjectMapper om <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ObjectMapper</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        om<span class="token punctuation">.</span><span class="token function">setVisibility</span><span class="token punctuation">(</span>PropertyAccessor<span class="token punctuation">.</span>ALL<span class="token punctuation">,</span> JsonAutoDetect<span class="token punctuation">.</span>Visibility<span class="token punctuation">.</span>ANY<span class="token punctuation">)</span><span class="token punctuation">;</span>        om<span class="token punctuation">.</span><span class="token function">activateDefaultTyping</span><span class="token punctuation">(</span>LaissezFaireSubTypeValidator<span class="token punctuation">.</span>instance<span class="token punctuation">,</span> ObjectMapper<span class="token punctuation">.</span>DefaultTyping<span class="token punctuation">.</span>NON_FINAL<span class="token punctuation">)</span><span class="token punctuation">;</span>        jackson2JsonRedisSerializer<span class="token punctuation">.</span><span class="token function">setObjectMapper</span><span class="token punctuation">(</span>om<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">//String 的序列化</span>        StringRedisSerializer stringRedisSerializer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StringRedisSerializer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">//key采用String的序列化方式</span>        template<span class="token punctuation">.</span><span class="token function">setKeySerializer</span><span class="token punctuation">(</span>stringRedisSerializer<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">//hash的key采用String的序列化方式</span>        template<span class="token punctuation">.</span><span class="token function">setHashKeySerializer</span><span class="token punctuation">(</span>stringRedisSerializer<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">//value序列化方式采用jackson</span>        template<span class="token punctuation">.</span><span class="token function">setValueSerializer</span><span class="token punctuation">(</span>jackson2JsonRedisSerializer<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">//hash的value序列化方式采用jackson</span>        template<span class="token punctuation">.</span><span class="token function">setHashValueSerializer</span><span class="token punctuation">(</span>jackson2JsonRedisSerializer<span class="token punctuation">)</span><span class="token punctuation">;</span>        template<span class="token punctuation">.</span><span class="token function">afterPropertiesSet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> template<span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>这样只要在实体中实现序列化，就不会有乱码问题了</p><pre class=" language-java"><code class="language-java"><span class="token keyword">import</span> java<span class="token punctuation">.</span>io<span class="token punctuation">.</span>Serializable<span class="token punctuation">;</span><span class="token annotation punctuation">@Component</span><span class="token annotation punctuation">@NoArgsConstructor</span><span class="token annotation punctuation">@AllArgsConstructor</span><span class="token annotation punctuation">@Data</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token keyword">implements</span> <span class="token class-name">Serializable</span> <span class="token punctuation">{</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">long</span> serialVersionUID <span class="token operator">=</span> 1L<span class="token punctuation">;</span>    <span class="token keyword">private</span> String name<span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token keyword">int</span> age<span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><h2 id="7-1、自定义Redis工具类网上好多："><a href="#7-1、自定义Redis工具类网上好多：" class="headerlink" title="7.1、自定义Redis工具类网上好多："></a>7.1、自定义Redis工具类网上好多：</h2><p><a href="https://blog.csdn.net/ye17186/article/details/87934399">redis工具类</a><br><a href="https://blog.csdn.net/qq_40925189/article/details/109585667">redis工具类</a></p><h1 id="8、Redis-conf详解"><a href="#8、Redis-conf详解" class="headerlink" title="8、Redis.conf详解"></a>8、Redis.conf详解</h1><h1 id="9、Redis"><a href="#9、Redis" class="headerlink" title="9、Redis"></a>9、Redis</h1><p>持久化RDB于AOF详情请见：<br><a href="https://blog.csdn.net/weixin_45416687/article/details/115283376">https://blog.csdn.net/weixin_45416687/article/details/115283376</a></p><h1 id="10、Redis发布订阅"><a href="#10、Redis发布订阅" class="headerlink" title="10、Redis发布订阅"></a>10、Redis发布订阅</h1><p>Redis发布订阅（pub/sub）是一种消息通信模式：发送者（pub）发送消息，订阅者（sub）接收消息。Redis客户端可以订阅任意数量的频道<br>订阅/发布消息图：<br><img src="https://edu-2539.oss-cn-beijing.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E5%9B%BE%E7%89%87/20210328181022397.png" alt="image"></p><p>下图展示了频道channel1，以及订阅这个频道的三个客户端–client2、client5和client1之间的关系：</p><p><img src="https://edu-2539.oss-cn-beijing.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E5%9B%BE%E7%89%87/20210328181658616.png" alt="image"></p><p>当有新消息通过PUBLISH命令发送给频道channel1时，这个消息就会被发送给订阅它的三个客户端：<br><img src="https://edu-2539.oss-cn-beijing.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E5%9B%BE%E7%89%87/20210328181708956.png" alt="image"></p><blockquote><p>命令</p></blockquote><p>这些命令被广泛用于构建即时通信应用，比如网络聊天室（chatroom）和实时广播、实时提醒等<br><img src="https://edu-2539.oss-cn-beijing.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E5%9B%BE%E7%89%87/20210328181735528.png" alt="image"></p><p>实例<br>以下实例演示了发布订阅是如何工作的，需要开启两个 redis-cli 客户端。<br>在我们实例中我们创建了订阅频道名为 runoobChat:</p><blockquote><p>第一个客户端<br>redis 127.0.0.1:6379&gt; SUBSCRIBE runoobChat<br>Reading messages… (press Ctrl-C to quit)“subscribe”“redisChat”(integer) 1</p></blockquote><p>现在，我们先重新开启个 redis 客户端，然后在同一个频道 runoobChat 发布两次消息，订阅者就能接收到消息。</p><blockquote><p>第二个客户端：<br>redis 127.0.0.1:6379&gt; PUBLISH runoobChat “Redis PUBLISH test”<br>(integer) 1<br>redis 127.0.0.1:6379&gt; PUBLISH runoobChat “Learn redis by runoob.com”<br>(integer) 1<br>订阅者的客户端会显示如下消息<br>“message”<br>“runoobChat”<br>“Redis PUBLISH test”<br>“message”<br>“runoobChat”<br>“Learn redis by runoob.com”</p></blockquote><blockquote><p>原理<br>Redis是使用C实现的，通过分析Redis源码里的pubsub.c文件，了解发布和订阅机制的底层实现，借此加深对Redis的理解。<br>Redis通过PUBLISH、SUBSCRIBE等命令实现发布和订阅功能</p></blockquote><p>通过SUBSCRIBE命令订阅某个频道后，redis-server里维护了一个字典，字典的键就是一个个频道！而字典的值则是一个链表，链表中保存了所有订阅这个channel的客户端。SUBSCRIBE命令的关键，就是将客户端添加到指定channel的订阅链表中<br>通过PUBLISH命令向订阅者发送消息，redis-server会使用给定的频道作为键，在它所维护的channel字典中查找记录了订阅这个频道的所有客户端的链表，遍历这个链表，将消息发布给所有订阅者</p><h1 id="11、Redis主从复制"><a href="#11、Redis主从复制" class="headerlink" title="11、Redis主从复制"></a>11、Redis主从复制</h1><h2 id="11-1-概念"><a href="#11-1-概念" class="headerlink" title="11.1 概念"></a>11.1 概念</h2><p> 主从复制，是指将一台Redis服务器的数据，复制到其他的Redis服务器。前者称为主节点（master/leader），后者称为从节点（slave/follower）；数据的复制是单向的，只能由主节点到从节点。Master以写为主，Slave以读为主。</p><p>默认情况下，每台Redis服务器都是主节点；且一个主节点可以有多个从节点（或没有从节点），但一个从节点只能有一个主节点。</p><blockquote><p>主从复制的作用主要包括：</p></blockquote><p>1、数据冗余：主从复制实现了数据的热备份，是持久化的一种数据冗余方式<br>2、故障恢复：当主节点出现问题时，可以由从节点提供服务，实现快速的故障恢复；实际上是一种服务的冗余<br>3、负载均衡：在主从复制的基础上，配合读写分离，可以由主节点提供写服务，由从节点提供读服务（即写Redis数据时应用连接主节点，读Redis数据时应用连接从节点），分担服务器负载；尤其是在写少读多的场景下，通过多个从节点分担读负载，可以大大提高Redis服务器的并发量<br>4、高可用基石：除了上述作用外，主从复制还是哨兵和集群能够实施的基础，因此说主从复制是Redis高可用的基础</p><hr><p>一般来说，要将Redis运用于工程项目中，只是用一台Redis是万万不能的，原因如下：<br>1、从结构上，单个Redis服务器会发生单点故障，并且一台服务器需要处理所有的请求负载，压力较大；<br>2、从容量上，单个Redis服务器内存容量优先，就算一台Redis服务器内存容量为256G，也不能将所有内存用作Redis存储内存，一般来说，单台Redis最大使用内存不应该超过20G<br><img src="https://edu-2539.oss-cn-beijing.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E5%9B%BE%E7%89%87/20210328193609365.png" alt="image"></p><p>环境配置，搭建伪集群</p><blockquote><p>修改配置文件<br>port：进程占用的端口号<br>pid（port id）：记录了进程的id，文件带有锁，可以防止程序的多次启动<br>logfile：明确日志文件位置<br>dbfilename：dumpxxx.file 持久化文件位置<br>如果设置了密码，需要在从机上添加masterauth 主机密码，否则从机连接不上主机<br><img src="https://edu-2539.oss-cn-beijing.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E5%9B%BE%E7%89%87/20210328195717981.png" alt="image"></p></blockquote><h2 id="11-2、主从复制之复制原理"><a href="#11-2、主从复制之复制原理" class="headerlink" title="11.2、主从复制之复制原理"></a>11.2、主从复制之复制原理</h2><p>默认情况下，每台Redis服务器都是主节点<br>查看命令：INFO replication<br><img src="https://edu-2539.oss-cn-beijing.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E5%9B%BE%E7%89%87/20210328200125258.png" alt="image"></p><p>一主二从<br>配置从机，认老大，一主（79）二从（80、81）<br>1.通过命令配置</p><pre class=" language-java"><code class="language-java"><span class="token number">192.168</span><span class="token punctuation">.</span><span class="token number">137.140</span><span class="token operator">:</span><span class="token number">6380</span><span class="token operator">></span> SLAVEOF <span class="token number">192.168</span><span class="token punctuation">.</span><span class="token number">137.140</span> <span class="token number">6379</span>  #配置从机  SLAVEOF host portOK<span class="token number">192.168</span><span class="token punctuation">.</span><span class="token number">137.140</span><span class="token operator">:</span><span class="token number">6380</span><span class="token operator">></span> info replication #查看# Replicationrole<span class="token operator">:</span>slave #当前角色master_host<span class="token operator">:</span><span class="token number">192.168</span><span class="token punctuation">.</span><span class="token number">137.140</span>  #查看主机的配置master_port<span class="token operator">:</span><span class="token number">6379</span>master_link_status<span class="token operator">:</span>downmaster_last_io_seconds_ago<span class="token operator">:</span><span class="token operator">-</span><span class="token number">1</span>master_sync_in_progress<span class="token operator">:</span><span class="token number">0</span>slave_repl_offset<span class="token operator">:</span><span class="token number">1</span>master_link_down_since_seconds<span class="token operator">:</span><span class="token number">1616933195</span>slave_priority<span class="token operator">:</span><span class="token number">100</span>slave_read_only<span class="token operator">:</span><span class="token number">1</span>connected_slaves<span class="token operator">:</span><span class="token number">0</span>master_replid<span class="token operator">:</span>60515091a402e7416c97cf7fc9d95b212f3b38a2master_replid2<span class="token operator">:</span><span class="token number">0000000000000000000000000000000000000000</span>master_repl_offset<span class="token operator">:</span><span class="token number">0</span>second_repl_offset<span class="token operator">:</span><span class="token operator">-</span><span class="token number">1</span>repl_backlog_active<span class="token operator">:</span><span class="token number">0</span>repl_backlog_size<span class="token operator">:</span><span class="token number">1048576</span>repl_backlog_first_byte_offset<span class="token operator">:</span><span class="token number">0</span>repl_backlog_histlen<span class="token operator">:</span><span class="token number">0</span>################################################配置完成后，也可以在主机上查看从机配置<span class="token number">192.168</span><span class="token punctuation">.</span><span class="token number">137.140</span><span class="token operator">:</span><span class="token number">6379</span><span class="token operator">></span> info replication# Replicationrole<span class="token operator">:</span>masterconnected_slaves<span class="token operator">:</span><span class="token number">2</span> #已经连接两个从节点slave0<span class="token operator">:</span>ip<span class="token operator">=</span><span class="token number">192.168</span><span class="token punctuation">.</span><span class="token number">137.140</span><span class="token punctuation">,</span>port<span class="token operator">=</span><span class="token number">6380</span><span class="token punctuation">,</span>state<span class="token operator">=</span>online<span class="token punctuation">,</span>offset<span class="token operator">=</span><span class="token number">84</span><span class="token punctuation">,</span>lag<span class="token operator">=</span><span class="token number">0</span>slave1<span class="token operator">:</span>ip<span class="token operator">=</span><span class="token number">192.168</span><span class="token punctuation">.</span><span class="token number">137.140</span><span class="token punctuation">,</span>port<span class="token operator">=</span><span class="token number">6381</span><span class="token punctuation">,</span>state<span class="token operator">=</span>online<span class="token punctuation">,</span>offset<span class="token operator">=</span><span class="token number">84</span><span class="token punctuation">,</span>lag<span class="token operator">=</span><span class="token number">0</span>master_replid<span class="token operator">:</span>3d553be66e2a6e5c19dbeb104fb224a3e093517dmaster_replid2<span class="token operator">:</span><span class="token number">0000000000000000000000000000000000000000</span>master_repl_offset<span class="token operator">:</span><span class="token number">84</span>second_repl_offset<span class="token operator">:</span><span class="token operator">-</span><span class="token number">1</span>repl_backlog_active<span class="token operator">:</span><span class="token number">1</span>repl_backlog_size<span class="token operator">:</span><span class="token number">1048576</span>repl_backlog_first_byte_offset<span class="token operator">:</span><span class="token number">1</span>repl_backlog_histlen<span class="token operator">:</span><span class="token number">84</span></code></pre><p>2.通过修改配置文件配置<br><img src="https://edu-2539.oss-cn-beijing.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E5%9B%BE%E7%89%87/2021032820241324.png" alt="image"></p><blockquote><p>细节</p></blockquote><p>主机可以写，从机不能写只能读！主机中的所有信息和数据，都会在从机自动保存<br>主机写：<br><img src="https://edu-2539.oss-cn-beijing.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E5%9B%BE%E7%89%87/20210328202810617.png" alt="image"><br>从机只能读取内容<br><img src="https://edu-2539.oss-cn-beijing.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E5%9B%BE%E7%89%87/20210328202858157.png" alt="image"></p><ul><li>主机断开连接，从机依旧连接主机，但是没有写的操作</li><li>从机断开后，重新连接后，成为从机后，依旧会获取到断开时的主机数据<blockquote><p>复制原理<br>Slave启动成功连接到master后会发送一个sync同步命令<br>Master接到命令后，启动后台的存盘进程，同时收集所有接收到的用于修改数据集命令，在后台进程执行完毕后，master将传送整个数据文件到slave，并完成一次完全同步</p></blockquote></li><li>*<u><em>全量复制</em></u>**：slave服务在接收到数据库文件数据后，将其存盘并加载到内存中</li><li>*<u><em>增量复制</em></u>**：Master继续将新的所有收集到的修改命令一次传给slave，完成同步<br>但是只要是重新来凝结master，一次完全同步（全量复制）将被自动执行</li></ul><blockquote><p>层层链路</p></blockquote><p>上一个M连接下一个S！<br><img src="https://edu-2539.oss-cn-beijing.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E5%9B%BE%E7%89%87/20210328204305760.png" alt="image"></p><blockquote><p>如果没有老大了，这个时候能不能选择一个老大出来？手动</p></blockquote><p>如果主机79断开了链接，我们可以使用slaveof no one让80自己变成主节点，如果这个时候主机79恢复了，也不会改变谋朝篡位成功的80</p><h1 id="12、哨兵模式-（自动选老大）"><a href="#12、哨兵模式-（自动选老大）" class="headerlink" title="12、哨兵模式 （自动选老大）"></a>12、哨兵模式 （自动选老大）</h1><h2 id="12-1概述"><a href="#12-1概述" class="headerlink" title="12.1概述"></a>12.1概述</h2><p>主从切换计数的方法是：当主服务器宕机后，需要手动把一台从服务器切换为主服务器，这就需要人工干预，费时费力，还会造成一段时间内服务不可用。这不是一种推荐的方式，更多时候，我们优先考虑哨兵模式。Redis从2.8开始正式提供了Sentinel（哨兵）架构来解决这个问题</p><p>谋朝篡位的自动版，能够后台监控主机是否故障，如果故障了根据投票数自动将从库转换为主库</p><p>哨兵模式是一种特殊的模式，首先Redis提供了哨兵的命令，哨兵是一个独立的进程，作为进程，它会独立运行。其原理是哨兵通过发送命令，等待Redis服务器响应，从而监控运行的多个Redis实例<br><img src="https://edu-2539.oss-cn-beijing.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E5%9B%BE%E7%89%87/20210328210041629.png" alt="image"><br>这里的哨兵有两个作用</p><ul><li>通过发送命令，让Redis服务器的返回监控其运行状态，包括主服务器和从服务器</li><li>当哨兵监测到master宕机，会自动将slave切换程master，然后通过发布订阅模式通知其他的从服务器，修改配置文件，让它么切换主机</li></ul><p>然而一个哨兵进行对Redis服务器进行监控，可能会出现问题，为此，我们可以使用多个哨兵进行监控。各个哨兵之间还会进行监控，这样就形成了多哨兵模式</p><p><img src="https://edu-2539.oss-cn-beijing.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E5%9B%BE%E7%89%87/2021032821051280.png" alt="image"><br>假设主服务器宕机，哨兵1先检测到这个结果，系统并不会马上进行failover过程，仅仅是哨兵1主观的认为主服务器不可用，这个现象称为主观下线 当后面的哨兵也检测到主服务器不可用，并且数量达到一定值时，那么哨兵之间就会进行一次投票，投票的结果由一个哨兵发起，进行failover【故障转移】操作。切换成功后，就会通过发布订阅模式，让各个哨兵把自己监控的从服务器实现切换主机，这个过程称为客观下线</p><blockquote><p>测试</p></blockquote><p>我们目前的状态是一主二从<br>1、配置哨兵配置文件 sentinel.conf</p><pre class=" language-java"><code class="language-java">vim sentinel<span class="token punctuation">.</span>conf# sentinel monitor 被监控的主机名称 host port <span class="token number">1</span>sentinel monitor myredis <span class="token number">192.168</span><span class="token punctuation">.</span><span class="token number">137.140</span> <span class="token number">6379</span> <span class="token number">1</span>#后面这个数字<span class="token number">1</span>，代表主机挂了，slave投票让谁接替成为主机，票数最多的，就会成为主机#有密码的需要在配置文件中增加sentinel auth<span class="token operator">-</span>pass <span class="token operator">&lt;</span>master<span class="token operator">-</span>name<span class="token operator">></span> <span class="token operator">&lt;</span>password<span class="token operator">></span></code></pre><p><img src="https://edu-2539.oss-cn-beijing.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E5%9B%BE%E7%89%87/2021032821275945.png" alt="image"></p><p>2、启动哨兵</p><pre class=" language-java"><code class="language-java"># redis<span class="token operator">-</span>sentinel sentinel的配置文件<span class="token punctuation">[</span>root<span class="token annotation punctuation">@localhost</span> bin<span class="token punctuation">]</span># redis<span class="token operator">-</span>sentinel redisconfig<span class="token operator">/</span>sentinel<span class="token punctuation">.</span>conf <span class="token number">20858</span><span class="token operator">:</span>X <span class="token number">28</span> Mar <span class="token number">2021</span> <span class="token number">21</span><span class="token operator">:</span><span class="token number">28</span><span class="token operator">:</span><span class="token number">22.566</span> # oO0OoO0OoO0Oo Redis is starting oO0OoO0OoO0Oo<span class="token number">20858</span><span class="token operator">:</span>X <span class="token number">28</span> Mar <span class="token number">2021</span> <span class="token number">21</span><span class="token operator">:</span><span class="token number">28</span><span class="token operator">:</span><span class="token number">22.566</span> # Redis version<span class="token operator">=</span><span class="token number">5.0</span><span class="token punctuation">.</span><span class="token number">12</span><span class="token punctuation">,</span> bits<span class="token operator">=</span><span class="token number">64</span><span class="token punctuation">,</span> commit<span class="token operator">=</span><span class="token number">00000000</span><span class="token punctuation">,</span> modified<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span> pid<span class="token operator">=</span><span class="token number">20858</span><span class="token punctuation">,</span> just started<span class="token number">20858</span><span class="token operator">:</span>X <span class="token number">28</span> Mar <span class="token number">2021</span> <span class="token number">21</span><span class="token operator">:</span><span class="token number">28</span><span class="token operator">:</span><span class="token number">22.566</span> # Configuration loaded<span class="token number">20858</span><span class="token operator">:</span>X <span class="token number">28</span> Mar <span class="token number">2021</span> <span class="token number">21</span><span class="token operator">:</span><span class="token number">28</span><span class="token operator">:</span><span class="token number">22.567</span> <span class="token operator">*</span> Increased maximum number of open files to <span class="token function">10032</span> <span class="token punctuation">(</span>it was originally set to <span class="token number">1024</span><span class="token punctuation">)</span><span class="token punctuation">.</span>                _<span class="token punctuation">.</span>_                                                             _<span class="token punctuation">.</span>-``__ <span class="token string">''</span><span class="token operator">-</span><span class="token punctuation">.</span>_                                                   _<span class="token punctuation">.</span>-``    `<span class="token punctuation">.</span>  `_<span class="token punctuation">.</span>  <span class="token string">''</span><span class="token operator">-</span><span class="token punctuation">.</span>_           Redis <span class="token number">5.0</span><span class="token punctuation">.</span><span class="token function">12</span> <span class="token punctuation">(</span><span class="token number">00000000</span><span class="token operator">/</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token number">64</span> bit  <span class="token punctuation">.</span>-`` <span class="token punctuation">.</span>-```<span class="token punctuation">.</span>  ```\<span class="token operator">/</span>    _<span class="token punctuation">.</span><span class="token punctuation">,</span>_ <span class="token string">''</span><span class="token operator">-</span><span class="token punctuation">.</span><span class="token function">_</span>                                    <span class="token punctuation">(</span>    '      <span class="token punctuation">,</span>       <span class="token punctuation">.</span>-`  <span class="token operator">|</span> `<span class="token punctuation">,</span>    <span class="token punctuation">)</span>     Running in sentinel mode <span class="token operator">|</span>`<span class="token operator">-</span><span class="token punctuation">.</span>_`<span class="token operator">-</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>-` __<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>-<span class="token punctuation">.</span>``<span class="token operator">-</span><span class="token punctuation">.</span>_<span class="token operator">|</span><span class="token string">'` _.-'</span><span class="token operator">|</span>     Port<span class="token operator">:</span> <span class="token number">26379</span> <span class="token operator">|</span>    `<span class="token operator">-</span><span class="token punctuation">.</span>_   `<span class="token punctuation">.</span>_    <span class="token operator">/</span>     _<span class="token punctuation">.</span>-'    <span class="token operator">|</span>     PID<span class="token operator">:</span> <span class="token number">20858</span>  `<span class="token operator">-</span><span class="token punctuation">.</span>_    `<span class="token operator">-</span><span class="token punctuation">.</span>_  `<span class="token operator">-</span><span class="token punctuation">.</span>/  _<span class="token punctuation">.</span>-<span class="token string">'    _.-'</span>                                    <span class="token operator">|</span>`<span class="token operator">-</span><span class="token punctuation">.</span>_`<span class="token operator">-</span><span class="token punctuation">.</span>_    `<span class="token operator">-</span><span class="token punctuation">.</span>__<span class="token punctuation">.</span>-<span class="token string">'    _.-'</span>_<span class="token punctuation">.</span>-'<span class="token operator">|</span>                                   <span class="token operator">|</span>    `<span class="token operator">-</span><span class="token punctuation">.</span>_`<span class="token operator">-</span><span class="token punctuation">.</span>_        _<span class="token punctuation">.</span>-<span class="token string">'_.-'</span>    <span class="token operator">|</span>           http<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>redis<span class="token punctuation">.</span>io          `<span class="token operator">-</span><span class="token punctuation">.</span>_    `<span class="token operator">-</span><span class="token punctuation">.</span>_`<span class="token operator">-</span><span class="token punctuation">.</span>__<span class="token punctuation">.</span>-<span class="token string">'_.-'</span>    _<span class="token punctuation">.</span>-'                                    <span class="token operator">|</span>`<span class="token operator">-</span><span class="token punctuation">.</span>_`<span class="token operator">-</span><span class="token punctuation">.</span>_    `<span class="token operator">-</span><span class="token punctuation">.</span>__<span class="token punctuation">.</span>-<span class="token string">'    _.-'</span>_<span class="token punctuation">.</span>-'<span class="token operator">|</span>                                   <span class="token operator">|</span>    `<span class="token operator">-</span><span class="token punctuation">.</span>_`<span class="token operator">-</span><span class="token punctuation">.</span>_        _<span class="token punctuation">.</span>-<span class="token string">'_.-'</span>    <span class="token operator">|</span>                                    `<span class="token operator">-</span><span class="token punctuation">.</span>_    `<span class="token operator">-</span><span class="token punctuation">.</span>_`<span class="token operator">-</span><span class="token punctuation">.</span>__<span class="token punctuation">.</span>-<span class="token string">'_.-'</span>    _<span class="token punctuation">.</span>-'                                         `<span class="token operator">-</span><span class="token punctuation">.</span>_    `<span class="token operator">-</span><span class="token punctuation">.</span>__<span class="token punctuation">.</span>-<span class="token string">'    _.-'</span>                                                 `<span class="token operator">-</span><span class="token punctuation">.</span>_        _<span class="token punctuation">.</span>-'                                                         `<span class="token operator">-</span><span class="token punctuation">.</span>__<span class="token punctuation">.</span>-'                                               <span class="token number">20858</span><span class="token operator">:</span>X <span class="token number">28</span> Mar <span class="token number">2021</span> <span class="token number">21</span><span class="token operator">:</span><span class="token number">28</span><span class="token operator">:</span><span class="token number">22.568</span> # WARNING<span class="token operator">:</span> The TCP backlog setting of <span class="token number">511</span> cannot be enforced because <span class="token operator">/</span>proc<span class="token operator">/</span>sys<span class="token operator">/</span>net<span class="token operator">/</span>core<span class="token operator">/</span>somaxconn is set to the lower value of <span class="token number">128</span><span class="token punctuation">.</span><span class="token number">20858</span><span class="token operator">:</span>X <span class="token number">28</span> Mar <span class="token number">2021</span> <span class="token number">21</span><span class="token operator">:</span><span class="token number">28</span><span class="token operator">:</span><span class="token number">22.569</span> # Sentinel ID is dc245ae88de15c20a29fba857c5f046c27fa6f44<span class="token number">20858</span><span class="token operator">:</span>X <span class="token number">28</span> Mar <span class="token number">2021</span> <span class="token number">21</span><span class="token operator">:</span><span class="token number">28</span><span class="token operator">:</span><span class="token number">22.569</span> # <span class="token operator">+</span>monitor master myredis <span class="token number">192.168</span><span class="token punctuation">.</span><span class="token number">137.140</span> <span class="token number">6379</span> quorum <span class="token number">1</span><span class="token number">20858</span><span class="token operator">:</span>X <span class="token number">28</span> Mar <span class="token number">2021</span> <span class="token number">21</span><span class="token operator">:</span><span class="token number">28</span><span class="token operator">:</span><span class="token number">22.574</span> <span class="token operator">*</span> <span class="token operator">+</span>slave slave <span class="token number">192.168</span><span class="token punctuation">.</span><span class="token number">137.140</span><span class="token operator">:</span><span class="token number">6380</span> <span class="token number">192.168</span><span class="token punctuation">.</span><span class="token number">137.140</span> <span class="token number">6380</span> @ myredis <span class="token number">192.168</span><span class="token punctuation">.</span><span class="token number">137.140</span> <span class="token number">6379</span><span class="token number">20858</span><span class="token operator">:</span>X <span class="token number">28</span> Mar <span class="token number">2021</span> <span class="token number">21</span><span class="token operator">:</span><span class="token number">28</span><span class="token operator">:</span><span class="token number">22.575</span> <span class="token operator">*</span> <span class="token operator">+</span>slave slave <span class="token number">192.168</span><span class="token punctuation">.</span><span class="token number">137.140</span><span class="token operator">:</span><span class="token number">6381</span> <span class="token number">192.168</span><span class="token punctuation">.</span><span class="token number">137.140</span> <span class="token number">6381</span> @ myredis <span class="token number">192.168</span><span class="token punctuation">.</span><span class="token number">137.140</span> <span class="token number">6379</span></code></pre><p>如果Master节点断开了，这个时候就会从从机中选出一个服务器成为主节点<br><img src="https://edu-2539.oss-cn-beijing.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E5%9B%BE%E7%89%87/20210328213413384.png" alt="iamge"><br><img src="https://edu-2539.oss-cn-beijing.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E5%9B%BE%E7%89%87/20210328213303718.png" alt="image"></p><p>如果主机79恢复了，那也只能成为80的从机</p><h2 id="12-2、哨兵模式的优缺点"><a href="#12-2、哨兵模式的优缺点" class="headerlink" title="12.2、哨兵模式的优缺点"></a>12.2、哨兵模式的优缺点</h2><p>优点1、哨兵集群，基于主从复制模式，所有主从配置的优点，它全有<br>2、主从可以切换，故障可以转移，系统的可用性会更好<br>3、哨兵模式就是主从模式的升级，手动到自动，更加健壮<br>缺点<br>1、Redis不好在线扩容，集群容量一旦达到上限，在线扩容就十分麻烦<br>2、哨兵模式配置麻烦</p><blockquote><p>哨兵模式的全部配置sentinel.conf</p></blockquote><pre class=" language-java"><code class="language-java"># Example sentinel<span class="token punctuation">.</span>conf # 哨兵sentinel实例运行的端口 默认<span class="token number">26379</span>port <span class="token number">26379</span> # 哨兵sentinel的工作目录dir <span class="token operator">/</span>tmp # 哨兵sentinel监控的redis主节点的 ip port # master<span class="token operator">-</span>name  可以自己命名的主节点名字 只能由字母A<span class="token operator">-</span>z、数字<span class="token number">0</span><span class="token operator">-</span><span class="token number">9</span> 、这三个字符<span class="token string">".-_"</span>组成。# quorum 当这些quorum个数sentinel哨兵认为master主节点失联 那么这时 客观上认为主节点失联了# sentinel monitor <span class="token operator">&lt;</span>master<span class="token operator">-</span>name<span class="token operator">></span> <span class="token operator">&lt;</span>ip<span class="token operator">></span> <span class="token operator">&lt;</span>redis<span class="token operator">-</span>port<span class="token operator">></span> <span class="token operator">&lt;</span>quorum<span class="token operator">></span>sentinel monitor mymaster <span class="token number">127.0</span><span class="token punctuation">.</span><span class="token number">0.1</span> <span class="token number">6379</span> <span class="token number">1</span> # 当在Redis实例中开启了requirepass foobared 授权密码 这样所有连接Redis实例的客户端都要提供密码# 设置哨兵sentinel 连接主从的密码 注意必须为主从设置一样的验证密码# sentinel auth<span class="token operator">-</span>pass <span class="token operator">&lt;</span>master<span class="token operator">-</span>name<span class="token operator">></span> <span class="token operator">&lt;</span>password<span class="token operator">></span>sentinel auth<span class="token operator">-</span>pass mymaster <span class="token number">123</span>  # 指定多少毫秒之后 主节点没有应答哨兵sentinel 此时 哨兵主观上认为主节点下线 默认<span class="token number">30</span>秒# sentinel down<span class="token operator">-</span>after<span class="token operator">-</span>milliseconds <span class="token operator">&lt;</span>master<span class="token operator">-</span>name<span class="token operator">></span> <span class="token operator">&lt;</span>milliseconds<span class="token operator">></span>sentinel down<span class="token operator">-</span>after<span class="token operator">-</span>milliseconds mymaster <span class="token number">30000</span> # 这个配置项指定了在发生failover主备切换时最多可以有多少个slave同时对新的master进行 同步，这个数字越小，完成failover所需的时间就越长，但是如果这个数字越大，就意味着越 多的slave因为replication而不可用。可以通过将这个值设为 <span class="token number">1</span> 来保证每次只有一个slave 处于不能处理命令请求的状态。# sentinel parallel<span class="token operator">-</span>syncs <span class="token operator">&lt;</span>master<span class="token operator">-</span>name<span class="token operator">></span> <span class="token operator">&lt;</span>numslaves<span class="token operator">></span>sentinel parallel<span class="token operator">-</span>syncs mymaster <span class="token number">1</span>   # 故障转移的超时时间 failover<span class="token operator">-</span>timeout 可以用在以下这些方面： #<span class="token number">1</span><span class="token punctuation">.</span> 同一个sentinel对同一个master两次failover之间的间隔时间。#<span class="token number">2</span><span class="token punctuation">.</span> 当一个slave从一个错误的master那里同步数据开始计算时间。直到slave被纠正为向正确的master那里同步数据时。#<span class="token number">3</span><span class="token punctuation">.</span>当想要取消一个正在进行的failover所需要的时间。  #<span class="token number">4</span><span class="token punctuation">.</span>当进行failover时，配置所有slaves指向新的master所需的最大时间。不过，即使过了这个超时，slaves依然会被正确配置为指向master，但是就不按parallel<span class="token operator">-</span>syncs所配置的规则来了# 默认三分钟# sentinel failover<span class="token operator">-</span>timeout <span class="token operator">&lt;</span>master<span class="token operator">-</span>name<span class="token operator">></span> <span class="token operator">&lt;</span>milliseconds<span class="token operator">></span>sentinel failover<span class="token operator">-</span>timeout mymaster <span class="token number">180000</span> # SCRIPTS EXECUTION #配置当某一事件发生时所需要执行的脚本，可以通过脚本来通知管理员，例如当系统运行不正常时发邮件通知相关人员。#对于脚本的运行结果有以下规则：#若脚本执行后返回<span class="token number">1</span>，那么该脚本稍后将会被再次执行，重复次数目前默认为<span class="token number">10</span>#若脚本执行后返回<span class="token number">2</span>，或者比<span class="token number">2</span>更高的一个返回值，脚本将不会重复执行。#如果脚本在执行过程中由于收到系统中断信号被终止了，则同返回值为<span class="token number">1</span>时的行为相同。#一个脚本的最大执行时间为60s，如果超过这个时间，脚本将会被一个SIGKILL信号终止，之后重新执行。 #通知型脚本<span class="token operator">:</span>当sentinel有任何警告级别的事件发生时（比如说redis实例的主观失效和客观失效等等），将会去调用这个脚本，#这时这个脚本应该通过邮件，SMS等方式去通知系统管理员关于系统不正常运行的信息。调用该脚本时，将传给脚本两个参数，#一个是事件的类型，#一个是事件的描述。#如果sentinel<span class="token punctuation">.</span>conf配置文件中配置了这个脚本路径，那么必须保证这个脚本存在于这个路径，并且是可执行的，否则sentinel无法正常启动成功。#通知脚本# sentinel notification<span class="token operator">-</span>script <span class="token operator">&lt;</span>master<span class="token operator">-</span>name<span class="token operator">></span> <span class="token operator">&lt;</span>script<span class="token operator">-</span>path<span class="token operator">></span>  sentinel notification<span class="token operator">-</span>script mymaster <span class="token operator">/</span>var<span class="token operator">/</span>redis<span class="token operator">/</span>notify<span class="token punctuation">.</span>sh # 客户端重新配置主节点参数脚本# 当一个master由于failover而发生改变时，这个脚本将会被调用，通知相关的客户端关于master地址已经发生改变的信息。# 以下参数将会在调用脚本时传给脚本<span class="token operator">:</span># <span class="token operator">&lt;</span>master<span class="token operator">-</span>name<span class="token operator">></span> <span class="token operator">&lt;</span>role<span class="token operator">></span> <span class="token operator">&lt;</span>state<span class="token operator">></span> <span class="token operator">&lt;</span>from<span class="token operator">-</span>ip<span class="token operator">></span> <span class="token operator">&lt;</span>from<span class="token operator">-</span>port<span class="token operator">></span> <span class="token operator">&lt;</span>to<span class="token operator">-</span>ip<span class="token operator">></span> <span class="token operator">&lt;</span>to<span class="token operator">-</span>port<span class="token operator">></span># 目前<span class="token operator">&lt;</span>state<span class="token operator">></span>总是“failover”<span class="token punctuation">,</span># <span class="token operator">&lt;</span>role<span class="token operator">></span>是“leader”或者“observer”中的一个。 # 参数 from<span class="token operator">-</span>ip<span class="token punctuation">,</span> from<span class="token operator">-</span>port<span class="token punctuation">,</span> to<span class="token operator">-</span>ip<span class="token punctuation">,</span> to<span class="token operator">-</span>port是用来和旧的master和新的<span class="token function">master</span><span class="token punctuation">(</span>即旧的slave<span class="token punctuation">)</span>通信的# 这个脚本应该是通用的，能被多次调用，不是针对性的。# sentinel client<span class="token operator">-</span>reconfig<span class="token operator">-</span>script <span class="token operator">&lt;</span>master<span class="token operator">-</span>name<span class="token operator">></span> <span class="token operator">&lt;</span>script<span class="token operator">-</span>path<span class="token operator">></span></code></pre><h1 id="13、Redis缓存穿透和雪崩"><a href="#13、Redis缓存穿透和雪崩" class="headerlink" title="13、Redis缓存穿透和雪崩"></a>13、Redis缓存穿透和雪崩</h1><p>Redis缓存的使用，极大的提升了应用程序的性能和效率，特别是数据查询方面。但同时，它也带来了一些问题。其中，最要害的问题就是数据一致性的问题，从严格意义上讲，这个问题无解，如果对数据的一致性要求很高，那么就不能使用缓存</p><h2 id="13-1、Redis缓存穿透（查不到）"><a href="#13-1、Redis缓存穿透（查不到）" class="headerlink" title="13.1、Redis缓存穿透（查不到）"></a>13.1、Redis缓存穿透（查不到）</h2><blockquote><p>概念</p></blockquote><p>缓存穿透的概念很简单，用户想要查询一个数据，发现redis内存数据库没有，也就是缓存没有命中，于是向持久层数据库查询。发现也没有，于是本次查询失败。当用户很多的时候，缓存都没有命中，于是都去请求了持久层数据库，这会给持久层数据库造成很大的压力，这时候就相当于出现了缓存穿透</p><blockquote><p>解决方案</p></blockquote><p>布隆过滤器布隆过滤器是一种数据结构，对所有可能查询的参数以hash形式存储，在控制层先进行校验，不符合则丢弃，从而避免了对底层存储系统的压力<br><img src="https://edu-2539.oss-cn-beijing.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E5%9B%BE%E7%89%87/20210328215915118.png" alt="image"></p><p>缓存空对象<br>当存储层不命中后，即使返回的空对象也将其缓存起来，同时会设置一个过期时间，之后再访问这个数据将会从缓存中获取，保护了后端数据源<br><img src="https://edu-2539.oss-cn-beijing.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E5%9B%BE%E7%89%87/20210328220055975.png" alt="image"><br>但是这两种方法会存在两个问题：<br>1、如果空值能够被缓存起来，这就意味着缓存需要更多的空间存储更多的键，因为这当中可能会有很多的空值的键<br>2、即使对空值设置了过期时间，还是会存在缓存层和存储层的数据会有一段时间窗口的不一致，这对于需要保持一致性的业务会有影响</p><h2 id="13-2、Redis缓存击穿（量太大，缓存过期）"><a href="#13-2、Redis缓存击穿（量太大，缓存过期）" class="headerlink" title="13.2、Redis缓存击穿（量太大，缓存过期）"></a>13.2、Redis缓存击穿（量太大，缓存过期）</h2><blockquote><p>概述</p></blockquote><p>这里需要注意和缓存击穿的区别，缓存击穿，是指一个key非常热点，在不停的扛着大并发，大并发集中对这一个点就行访问，当这个key在失效的瞬间，持续的大并发就穿破缓存，直接请求数据库，就像在一个屏障上凿开了一个洞。</p><p>当某个key在过期的瞬间，有大量的请求并发访问，这类数据一般是热点数据，由于缓存过期，会同时访问数据库来查询最新数据，并且回写缓存，会导致数据库瞬间压力过大</p><blockquote><p>解决方案</p></blockquote><p>设置热点数据永不过期<br>从缓存层面来看，没有设置过期时间，所以不会出现热点key过期后产生的问题<br>加互斥锁<br>分布式锁：使用分布式锁，保证对于灭个key同时只有一个线程去查询后端任务，其他线程没有获得分布式锁的权限，因此只需要等待即可，这种方式将高并发的压力转移到了分布式锁，因此对分布式锁的考验很大</p><h2 id="13-3、Redis缓存雪崩"><a href="#13-3、Redis缓存雪崩" class="headerlink" title="13.3、Redis缓存雪崩"></a>13.3、Redis缓存雪崩</h2><blockquote><p>概念</p></blockquote><p>缓存雪崩，是指在某一个时间段，缓存集中过期失效。Redis宕机</p><p>产生雪崩的原因之一，比如在写文本的时候，马上就要到双十一零点，很快就会迎来一波抢购，这波商品时间比较集中的放入了缓存，假设缓存一个小时，那么到了凌晨一点钟的时候，这批商品的缓存就都过期了。而对这批商品的访问查询，都落到了数据库上，对于数据库而言，就会产生周期性的压力波峰。于是所有的请求都会达到存储层，存储层的调用量会暴增，造车给存储层也会挂掉的情况<br><img src="https://edu-2539.oss-cn-beijing.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E5%9B%BE%E7%89%87/20210328221849605.png" alt="image"></p><blockquote><p>解决方案</p></blockquote><p>redis高可用<br>这个思想的含义是，既然redis有可能挂掉，那我多增加几台redis，这样一台挂掉之后其他的还可以继续工作，其实就是搭建的集群</p><p>限流降级<br>这个解决方案的思想是，在缓存失效后，通过加锁或者队列来控制都数据库写缓存的线程数量。比如对某个key只允许一个线程查询数据和写缓存，其他线程等待</p><p>数据预热<br>数据加热的含义就是在正式部署之前，我先把可能的数据先预先访问一遍，这样部分可能大量访问的数据就会加载到缓存中。在即将发生并发访问前手动触发加载缓存不同的key，设置不同的过期时间，让缓存失效的时间点尽量均匀</p><h1 id="鸣谢"><a href="#鸣谢" class="headerlink" title="鸣谢"></a>鸣谢</h1><p>本篇文章均为观看狂神说整理，只作为学习使用</p>]]></content>
      
      
      <categories>
          
          <category> Markdown </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Redis学习 </tag>
            
            <tag> 缓存机制 </tag>
            
            <tag> NoSql </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>SpringSecurity学习笔记</title>
      <link href="/2021/10/10/springsecurity-xue-xi-bi-ji/"/>
      <url>/2021/10/10/springsecurity-xue-xi-bi-ji/</url>
      
        <content type="html"><![CDATA[<h1 id="导包"><a href="#导包" class="headerlink" title="导包"></a>导包</h1><pre class=" language-java"><code class="language-java">    <span class="token operator">&lt;</span>dependency<span class="token operator">></span>            <span class="token operator">&lt;</span>groupId<span class="token operator">></span>org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token operator">&lt;</span><span class="token operator">/</span>groupId<span class="token operator">></span>            <span class="token operator">&lt;</span>artifactId<span class="token operator">></span>spring<span class="token operator">-</span>boot<span class="token operator">-</span>starter<span class="token operator">-</span>security<span class="token operator">&lt;</span><span class="token operator">/</span>artifactId<span class="token operator">></span>        <span class="token operator">&lt;</span><span class="token operator">/</span>dependency<span class="token operator">></span>        <span class="token operator">&lt;</span>dependency<span class="token operator">></span>            <span class="token operator">&lt;</span>groupId<span class="token operator">></span>org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token operator">&lt;</span><span class="token operator">/</span>groupId<span class="token operator">></span>            <span class="token operator">&lt;</span>artifactId<span class="token operator">></span>spring<span class="token operator">-</span>boot<span class="token operator">-</span>starter<span class="token operator">-</span>web<span class="token operator">&lt;</span><span class="token operator">/</span>artifactId<span class="token operator">></span>        <span class="token operator">&lt;</span><span class="token operator">/</span>dependency<span class="token operator">></span>        <span class="token operator">&lt;</span>dependency<span class="token operator">></span>            <span class="token operator">&lt;</span>groupId<span class="token operator">></span>org<span class="token punctuation">.</span>projectlombok<span class="token operator">&lt;</span><span class="token operator">/</span>groupId<span class="token operator">></span>            <span class="token operator">&lt;</span>artifactId<span class="token operator">></span>lombok<span class="token operator">&lt;</span><span class="token operator">/</span>artifactId<span class="token operator">></span>            <span class="token operator">&lt;</span>optional<span class="token operator">></span><span class="token boolean">true</span><span class="token operator">&lt;</span><span class="token operator">/</span>optional<span class="token operator">></span>        <span class="token operator">&lt;</span><span class="token operator">/</span>dependency<span class="token operator">></span>        <span class="token operator">&lt;</span>dependency<span class="token operator">></span>            <span class="token operator">&lt;</span>groupId<span class="token operator">></span>org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token operator">&lt;</span><span class="token operator">/</span>groupId<span class="token operator">></span>            <span class="token operator">&lt;</span>artifactId<span class="token operator">></span>spring<span class="token operator">-</span>boot<span class="token operator">-</span>starter<span class="token operator">-</span>test<span class="token operator">&lt;</span><span class="token operator">/</span>artifactId<span class="token operator">></span>            <span class="token operator">&lt;</span>scope<span class="token operator">></span>test<span class="token operator">&lt;</span><span class="token operator">/</span>scope<span class="token operator">></span>        <span class="token operator">&lt;</span><span class="token operator">/</span>dependency<span class="token operator">></span>        <span class="token operator">&lt;</span>dependency<span class="token operator">></span>            <span class="token operator">&lt;</span>groupId<span class="token operator">></span>org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>security<span class="token operator">&lt;</span><span class="token operator">/</span>groupId<span class="token operator">></span>            <span class="token operator">&lt;</span>artifactId<span class="token operator">></span>spring<span class="token operator">-</span>security<span class="token operator">-</span>test<span class="token operator">&lt;</span><span class="token operator">/</span>artifactId<span class="token operator">></span>            <span class="token operator">&lt;</span>scope<span class="token operator">></span>test<span class="token operator">&lt;</span><span class="token operator">/</span>scope<span class="token operator">></span>        <span class="token operator">&lt;</span><span class="token operator">/</span>dependency<span class="token operator">></span>        <span class="token operator">&lt;</span>dependency<span class="token operator">></span>            <span class="token operator">&lt;</span>groupId<span class="token operator">></span>org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token operator">&lt;</span><span class="token operator">/</span>groupId<span class="token operator">></span>            <span class="token operator">&lt;</span>artifactId<span class="token operator">></span>spring<span class="token operator">-</span>boot<span class="token operator">-</span>starter<span class="token operator">-</span>thymeleaf<span class="token operator">&lt;</span><span class="token operator">/</span>artifactId<span class="token operator">></span>        <span class="token operator">&lt;</span><span class="token operator">/</span>dependency<span class="token operator">></span>        <span class="token operator">&lt;</span>dependency<span class="token operator">></span>            <span class="token operator">&lt;</span>groupId<span class="token operator">></span>org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>jupiter<span class="token operator">&lt;</span><span class="token operator">/</span>groupId<span class="token operator">></span>            <span class="token operator">&lt;</span>artifactId<span class="token operator">></span>junit<span class="token operator">-</span>jupiter<span class="token operator">&lt;</span><span class="token operator">/</span>artifactId<span class="token operator">></span>            <span class="token operator">&lt;</span>version<span class="token operator">></span>RELEASE<span class="token operator">&lt;</span><span class="token operator">/</span>version<span class="token operator">></span>            <span class="token operator">&lt;</span>scope<span class="token operator">></span>test<span class="token operator">&lt;</span><span class="token operator">/</span>scope<span class="token operator">></span>        <span class="token operator">&lt;</span><span class="token operator">/</span>dependency<span class="token operator">></span></code></pre><h1 id=""><a href="#" class="headerlink" title=""></a></h1>]]></content>
      
      
      <categories>
          
          <category> Markdown </category>
          
      </categories>
      
      
        <tags>
            
            <tag> SpringSecurity </tag>
            
            <tag> 安全框架 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>添加博客记录</title>
      <link href="/2021/10/09/tian-jia-bo-ke-ji-lu/"/>
      <url>/2021/10/09/tian-jia-bo-ke-ji-lu/</url>
      
        <content type="html"><![CDATA[<h1 id="cc-showMessage"><a href="#cc-showMessage" class="headerlink" title="cc_showMessage"></a>cc_showMessage</h1><p> 创建博客文件指令 hexo n 博客名称</p><h2 id="这是一个二级标题"><a href="#这是一个二级标题" class="headerlink" title="这是一个二级标题"></a>这是一个二级标题</h2><p> 几级标题看多少个#号</p><h3 id="这是个三级标题哦"><a href="#这是个三级标题哦" class="headerlink" title="这是个三级标题哦"></a>这是个三级标题哦</h3><ul><li>列表1</li><li>列表2</li><li>列表三<br><a href="https://www.baidu.com/">百度导航</a><h4 id="图片插入"><a href="#图片插入" class="headerlink" title="图片插入"></a>图片插入</h4><img src="https://w.wallhaven.cc/full/72/wallhaven-72rkyv.jpg" alt="图片插入"></li></ul><hr><hr><h3 id="字体编辑"><a href="#字体编辑" class="headerlink" title="字体编辑"></a>字体编辑</h3><p><em>字体是斜线的</em><br><strong>字体加粗</strong></p><h3 id="插入代码"><a href="#插入代码" class="headerlink" title="插入代码"></a>插入代码</h3><p><code>&lt;html&gt;&lt;/html&gt;</code></p><h3 id="多行代码插入"><a href="#多行代码插入" class="headerlink" title="多行代码插入"></a>多行代码插入</h3><pre><code>&lt;html&gt;    &lt;a&gt;        这是一个代码块    &lt;/a&gt;&lt;/html&gt;</code></pre><h3 id="引用"><a href="#引用" class="headerlink" title="引用"></a>引用</h3><blockquote><p>这是一个引用</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> 前端 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 导航 </tag>
            
            <tag> 分享 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>我的第一篇博客</title>
      <link href="/2021/10/09/wo-de-di-yi-pian-bo-ke/"/>
      <url>/2021/10/09/wo-de-di-yi-pian-bo-ke/</url>
      
        <content type="html"><![CDATA[<p>简介<br>这是我的第一篇hexo博客。学习从这一刻开始。<br>第一天搭建学习内容<br>hexo s :启动服务器<br>hexo clean ：清理之前缓存<br>hexo g :加载静态内容<br>hexo clean &amp;&amp; hexo g &amp;&amp; hexo s ：可以直接运行这个程序<br>主体的配置主要是在theme的配置文件中<br>hexo d ：上传本地文件到github上<br>hexo n  博客名:创建博客</p>]]></content>
      
      
      
        <tags>
            
            <tag> 博客搭建记录 </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
